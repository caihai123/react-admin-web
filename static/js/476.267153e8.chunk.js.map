{"version":3,"file":"static/js/476.267153e8.chunk.js","mappings":"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","sources":["webpack://react-admin-web/./src/api/menu.ts","webpack://react-admin-web/./src/components/ModalForm.tsx","webpack://react-admin-web/./src/components/utils/createCompoundedComponent.ts","webpack://react-admin-web/./src/components/OptimisticSwitch.tsx","webpack://react-admin-web/./src/pages/system/role/AddOrEdit.tsx","webpack://react-admin-web/./src/api/role.ts","webpack://react-admin-web/./src/pages/system/role/Accredit.tsx","webpack://react-admin-web/./src/pages/system/role/index.tsx","webpack://react-admin-web/./src/utils/utils.ts"],"sourcesContent":["/* eslint-disable import/prefer-default-export */\r\nimport axios from \"@/utils/axios\";\r\nimport { menuType } from \"@/utils/dict\";\r\n\r\nimport type { AxiosResultPromise } from \"@/utils/axios\";\r\n\r\nexport type Menu = {\r\n  id: string;\r\n  title: string;\r\n  path: string;\r\n  type: (typeof menuType.options)[number][\"value\"];\r\n  icon: string;\r\n  children?: Menu[];\r\n  buttonList?: { id: string; name: string }[];\r\n};\r\n\r\n/**\r\n * 获取所有菜单\r\n */\r\nexport const getMenuAll: () => AxiosResultPromise<Array<Menu>> = () =>\r\n  axios.get(\"/api/menu/all\");\r\n\r\n/**\r\n * 删除菜单\r\n * @param id - id\r\n */\r\nexport const removeMenu: (id: string) => AxiosResultPromise<any> = (id) =>\r\n  axios.post(\"/api/menu/remove\", { id });\r\n","import { forwardRef, useImperativeHandle, useRef } from \"react\";\r\nimport { useBoolean } from \"ahooks\";\r\nimport { Modal, Form, Space, Button } from \"antd\";\r\nimport useLoadingDelayAndKeep from \"@/hooks/useLoadingDelayAndKeep\";\r\nimport createCompoundedComponent from \"./utils/createCompoundedComponent\";\r\n\r\nimport type { ReactNode, RefObject, ReactElement } from \"react\";\r\nimport type { ModalProps, FormProps } from \"antd\";\r\n\r\nexport type Ref = {\r\n  /** 打开 Modal */\r\n  open: () => void;\r\n  /** 关闭 Modal */\r\n  close: () => void;\r\n};\r\n\r\nexport type Props = {\r\n  /** 表单内容 */\r\n  children?: ReactNode;\r\n  /** Drawer title */\r\n  title?: ModalProps[\"title\"];\r\n  /** Drawer width */\r\n  width?: ModalProps[\"width\"];\r\n  /** 确认按钮文字 默认：确定 */\r\n  submitText?: ReactNode;\r\n  /** 取消按钮文字 默认：取消 */\r\n  cancelText?: ReactNode;\r\n  /** 提交表单后触发的事件 */\r\n  onFinish?: ((values: any) => void | Promise<any>) | undefined;\r\n  /** Drawer 底部内容，当不需要默认底部按钮时，可以设为 footer={null} 默认：确定取消按钮 */\r\n  footer?: ModalProps[\"footer\"];\r\n  /** 表单默认值 */\r\n  initialValues?: FormProps[\"initialValues\"];\r\n  form: FormProps[\"form\"];\r\n  // Modal 完全关闭后的回调\r\n  afterClose?: ModalProps[\"afterClose\"];\r\n  /** Modal 其他属性 优先级较高，可能会覆盖title，width等属性 */\r\n  modalProps?: ModalProps;\r\n  /** Form 其他属性 优先级较高，可能会覆盖onFinish，initialValues等属性 */\r\n  formProps?: FormProps;\r\n};\r\n\r\n/**\r\n * Modal 和 Form 的组合，方便在 Modal 中快速创建表单\r\n */\r\nconst ModalForm = forwardRef<Ref, Props>(function (props, ref) {\r\n  const {\r\n    title,\r\n    width,\r\n    submitText = \"确定\",\r\n    cancelText = \"取消\",\r\n    children,\r\n    modalProps,\r\n    formProps,\r\n    onFinish,\r\n    footer,\r\n    initialValues,\r\n    afterClose,\r\n  } = props;\r\n\r\n  const [open, { set: setOpen }] = useBoolean(false);\r\n\r\n  const [loading, setLoading] = useLoadingDelayAndKeep(false);\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    open: () => setOpen(true),\r\n    close: () => setOpen(false),\r\n  }));\r\n\r\n  return (\r\n    <Modal\r\n      title={title}\r\n      open={open}\r\n      onCancel={() => setOpen(false)}\r\n      width={width}\r\n      footer={\r\n        footer ? (\r\n          footer\r\n        ) : (\r\n          <Space>\r\n            <Button onClick={() => setOpen(false)}>{cancelText}</Button>\r\n            <Button\r\n              type=\"primary\"\r\n              loading={loading}\r\n              onClick={() => props.form?.submit()}\r\n            >\r\n              {submitText}\r\n            </Button>\r\n          </Space>\r\n        )\r\n      }\r\n      centered={true}\r\n      wrapClassName=\"custom-modal-style\"\r\n      maskClosable={false}\r\n      // style={{ marginTop: \"-20vh\" }}\r\n      afterClose={afterClose}\r\n      {...modalProps}\r\n    >\r\n      <Form\r\n        form={props.form}\r\n        autoComplete=\"off\"\r\n        onFinish={(values) => {\r\n          const fnResult = onFinish?.(values);\r\n          if (fnResult instanceof Promise) {\r\n            setLoading.setTrue();\r\n            fnResult\r\n              .then(() => setOpen(false))\r\n              .finally(() => setLoading.setFalse());\r\n          }\r\n        }}\r\n        layout=\"vertical\"\r\n        initialValues={initialValues}\r\n        {...formProps}\r\n      >\r\n        {children}\r\n      </Form>\r\n    </Modal>\r\n  );\r\n});\r\n\r\n// 帮你创建 ref 和 form，可以稍微减少使用时的代码量\r\nconst useModal: (\r\n  props: Omit<Props, \"form\">\r\n) => [RefObject<Ref>, FormProps[\"form\"], ReactElement] = function (props) {\r\n  const ref = useRef<Ref>(null);\r\n  const [form] = Form.useForm();\r\n\r\n  return [ref, form, <ModalForm ref={ref} form={form} {...props} />];\r\n};\r\n\r\nexport default createCompoundedComponent(ModalForm, {\r\n  useModal,\r\n});\r\n","import React from \"react\";\r\n\r\n// 定义子组件的类型\r\ninterface SubComponents {\r\n  [key: string]: any;\r\n}\r\n\r\n// 主组件和子组件的组合类型\r\ntype CompoundedComponent<F, T> = F & T;\r\n\r\n/**\r\n * 创建组合组件\r\n */\r\nexport default function createCompoundedComponent<\r\n  F extends React.FC<any>,\r\n  T extends SubComponents\r\n>(mainComponent: F, subComponents: T): CompoundedComponent<F, T> {\r\n  // 将主组件转换为复合组件类型\r\n  const Component = mainComponent as CompoundedComponent<F, T>;\r\n\r\n  // 使用 Object.defineProperty 添加子组件到主组件上\r\n  Object.keys(subComponents).forEach((key) => {\r\n    Object.defineProperty(Component, key, {\r\n      value: subComponents[key],\r\n      writable: false, // 确保子组件不可变\r\n      enumerable: true,\r\n    });\r\n  });\r\n\r\n  return Component;\r\n}\r\n","import { useBoolean } from \"ahooks\";\r\nimport { Switch } from \"antd\";\r\nimport useLoadingDelayAndKeep from \"@/hooks/useLoadingDelayAndKeep\";\r\n\r\n// 切换失败时自动撤销的 Optimistic Updates 开关\r\n// 注意：暂时还没完全想清楚此组件要不要作为公共基础组件存在\r\n\r\ntype Props = {\r\n  defaultChecked: boolean;\r\n  onChange: (val: boolean) => Promise<any> | null | undefined;\r\n};\r\n\r\nexport default function OptimisticSwitch({\r\n  defaultChecked = false,\r\n  onChange = () => null,\r\n}: Props) {\r\n  const [checked, { set }] = useBoolean(defaultChecked);\r\n  const [loading, { setTrue, setFalse }] = useLoadingDelayAndKeep(false);\r\n\r\n  return (\r\n    <Switch\r\n      checked={checked}\r\n      loading={loading}\r\n      onChange={(val) => {\r\n        set(val);\r\n        setTrue();\r\n        onChange(val)\r\n          ?.catch(() => {\r\n            set(!val);\r\n          })\r\n          .finally(() => setFalse());\r\n      }}\r\n    ></Switch>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { Form, Input, App } from \"antd\";\r\nimport axios from \"@/utils/axios\";\r\nimport ModalForm from \"@/components/ModalForm\";\r\nimport { Role } from \"@/api/role\";\r\nimport createCompoundedComponent from \"@/components/utils/createCompoundedComponent\";\r\n\r\nexport type Props = {\r\n  callback: (pageIndex?: number) => void;\r\n};\r\nexport type Ref = {\r\n  addStart: () => void;\r\n  editStart: (row: Role) => void;\r\n};\r\n\r\nconst AddOrEdit = React.forwardRef<Ref, Props>((props, ref) => {\r\n  const { message } = App.useApp();\r\n\r\n  const [id, setId] = React.useState(\"\");\r\n\r\n  const onSubmit = function (data: Pick<Role, \"roleName\" | \"description\">) {\r\n    const apiUrl = id ? \"/api/role/update\" : \"/api/role/add\";\r\n    const successMsg = id ? \"更新成功！\" : \"新增成功！\";\r\n    const params = id ? { id, ...data } : data;\r\n    const callback = () => props.callback(id ? undefined : 1);\r\n    return axios.post(apiUrl, params).then(() => {\r\n      message.success(successMsg);\r\n      callback();\r\n    });\r\n  };\r\n\r\n  const [modalFormRef, formInstance, contextHolder] = ModalForm.useModal({\r\n    title: id ? \"编辑\" : \"新增\",\r\n    width: 600,\r\n    afterClose: () => {\r\n      setId(\"\");\r\n      formInstance?.resetFields();\r\n    },\r\n    onFinish: onSubmit,\r\n    children: (\r\n      <>\r\n        <Form.Item\r\n          name=\"roleName\"\r\n          label=\"角色名称\"\r\n          rules={[{ required: true, message: \"请填写角色名称\" }]}\r\n        >\r\n          <Input placeholder=\"请输入\" />\r\n        </Form.Item>\r\n        <Form.Item name=\"description\" label=\"备注\">\r\n          <Input.TextArea placeholder=\"请输入\" />\r\n        </Form.Item>\r\n      </>\r\n    ),\r\n  });\r\n\r\n  React.useImperativeHandle(ref, () => ({\r\n    addStart: () => modalFormRef.current?.open(),\r\n    editStart: (row) => {\r\n      setId(row.id);\r\n      formInstance?.setFieldsValue(row);\r\n      modalFormRef.current?.open();\r\n    },\r\n  }));\r\n\r\n  return contextHolder;\r\n});\r\n\r\n// 可以稍微减少使用时的代码量\r\nconst useModal: (props: Props) => [React.RefObject<Ref>, React.ReactElement] =\r\n  function (props) {\r\n    const ref = React.useRef<Ref>(null);\r\n\r\n    return [ref, <AddOrEdit ref={ref} {...props} />];\r\n  };\r\n\r\nexport default createCompoundedComponent(AddOrEdit, { useModal });\r\n","/* eslint-disable import/prefer-default-export */\r\nimport axios from \"@/utils/axios\";\r\nimport { roleEnabledState } from \"@/utils/dict\";\r\n\r\nimport type { AxiosResultPromise } from \"@/utils/axios\";\r\n\r\nexport type Role = {\r\n  id: string;\r\n  roleName: string;\r\n  description: string;\r\n  status: (typeof roleEnabledState.options)[number][\"value\"];\r\n};\r\n\r\n/**\r\n * 分页获取角色列表\r\n * @param params - 查询参数\r\n * @param pageIndex - 页码 默认： 1\r\n * @param pageSize - 页大小 默认：10\r\n */\r\nexport const getRoleList: (\r\n  params: any,\r\n  pageIndex: number,\r\n  pageSize: number\r\n) => AxiosResultPromise<{\r\n  records: Role[];\r\n  total: number;\r\n  pageIndex: number;\r\n}> = (params, pageIndex = 1, pageSize = 10) => {\r\n  return axios.post(\"/api/role/page\", { params, pageIndex, pageSize });\r\n};\r\n\r\n/**\r\n * 通过id更新角色状态\r\n * @param id - id\r\n * @param status - 角色状态\r\n */\r\nexport const updateRoleStatusById: (\r\n  id: Role[\"id\"],\r\n  status: Role[\"status\"]\r\n) => AxiosResultPromise<any> = (id, status) => {\r\n  return axios.post(\"/api/role/status/update\", { id, status });\r\n};\r\n\r\n/**\r\n * 通过id删除角色\r\n * @param id - id\r\n */\r\nexport const removeRole: (id: string) => AxiosResultPromise<any> = (id) =>\r\n  axios.post(\"/api/role/remove\", { id });\r\n\r\n/**\r\n * 角色授权\r\n * @param params\r\n */\r\nexport const authRole: (params: any[]) => AxiosResultPromise<any> = (params) =>\r\n  axios.post(\"/api/role/auth\", params);\r\n","import React from \"react\";\r\nimport { Modal, Table, Tag, Checkbox, App } from \"antd\";\r\nimport { useBoolean, useRequest } from \"ahooks\";\r\nimport { getMenuAll } from \"@/api/menu\";\r\nimport { authRole } from \"@/api/role\";\r\nimport { menuType } from \"@/utils/dict\";\r\nimport createCompoundedComponent from \"@/components/utils/createCompoundedComponent\";\r\nimport { deepCopy, treeMap } from \"@/utils/utils\";\r\nimport useLoadingDelayAndKeep from \"@/hooks/useLoadingDelayAndKeep\";\r\nimport Mock from \"mockjs\";\r\n\r\ntype AuthMenu = {\r\n  id: string;\r\n  parentId: string;\r\n  title: string;\r\n  path: string;\r\n  type: (typeof menuType.options)[number][\"value\"];\r\n  icon: string;\r\n  children?: AuthMenu[];\r\n  isAuth: boolean;\r\n  buttonList?: { id: string; name: string; isAuth: boolean }[];\r\n};\r\n\r\nexport type Ref = {\r\n  start: (roleId: string) => void;\r\n};\r\n\r\nexport type Props = {\r\n  callback: () => void;\r\n};\r\n\r\n// 将tree菜单转成一维数组，此函数主要是给 selectParentMenu 使用\r\nconst flattenDeepMenu = (array: AuthMenu[] = []) => {\r\n  const list: AuthMenu[] = [];\r\n\r\n  const deep = function (obj: AuthMenu, parentId: string) {\r\n    // 不要创建新对象，因为 selectParentMenu 中会改变源数据，简洁达到修改tableData的效果\r\n    list.push(obj);\r\n    (obj.children || []).forEach((item) => deep(item, obj.id));\r\n  };\r\n  array.forEach((item) => deep(item, \"\"));\r\n\r\n  return list;\r\n};\r\n\r\n/**\r\n * 角色授权弹窗\r\n */\r\nconst Accredit = React.forwardRef<Ref, Props>((props, ref) => {\r\n  const [open, { set: setOpen }] = useBoolean(false);\r\n  const { message } = App.useApp();\r\n\r\n  // 获取当前角色的菜单菜单授权情况，这里只是使用 getMenuAll 进行模拟，实际情况不可能使用这个接口\r\n  const {\r\n    data: tableData,\r\n    loading,\r\n    mutate: mutateTableData,\r\n    run: getTableData,\r\n  } = useRequest(\r\n    async (roleId: string) => {\r\n      // 真实情况下获取菜单时必须要传入 roleId\r\n      const response = await getMenuAll();\r\n      return treeMap(response.result, (item) => ({\r\n        ...item,\r\n        isAuth: Mock.mock({ \"boolean|1-2\": false }).boolean, // mock 后后端返回的授权状态\r\n      })) as AuthMenu[];\r\n    },\r\n    { manual: true }\r\n  );\r\n\r\n  const [checkAll, setCheckAll] = React.useState<boolean>(false); // 控制表头是否全选\r\n  const [indeterminate, setIndeterminate] = React.useState<boolean>(false); // 是否有选中，控制控制表头半选状态\r\n\r\n  React.useEffect(() => {\r\n    // tableData改变时计算全选checkbox的状态\r\n    const isAuthAllList: boolean[] = [];\r\n\r\n    const deep = function (arr: AuthMenu[] = []) {\r\n      arr.forEach((item) => {\r\n        isAuthAllList.push(item.isAuth);\r\n        item.buttonList?.forEach((but) => {\r\n          isAuthAllList.push(but.isAuth);\r\n        });\r\n        deep(item.children);\r\n      });\r\n    };\r\n    deep(tableData);\r\n\r\n    if (isAuthAllList.every((item) => item === true)) {\r\n      setCheckAll(true);\r\n      setIndeterminate(false);\r\n    } else if (isAuthAllList.every((item) => item !== true)) {\r\n      setCheckAll(false);\r\n      setIndeterminate(false);\r\n    } else {\r\n      setCheckAll(false);\r\n      setIndeterminate(true);\r\n    }\r\n  }, [tableData]);\r\n\r\n  // 全选checkbox改变时触发\r\n  const checkAllChange = React.useCallback(\r\n    function (val: boolean) {\r\n      const deep = function (arr: AuthMenu[] = []) {\r\n        arr.forEach((item) => {\r\n          item.isAuth = val;\r\n          item.buttonList?.forEach((but) => {\r\n            but.isAuth = val;\r\n          });\r\n          deep(item.children);\r\n        });\r\n      };\r\n      deep(tableData);\r\n      mutateTableData(deepCopy(tableData));\r\n    },\r\n    [tableData, mutateTableData]\r\n  );\r\n\r\n  // 勾选菜单或目录时自动勾选所有父级菜单\r\n  const selectParentMenu = React.useCallback(\r\n    function (childId: string) {\r\n      const menuList = flattenDeepMenu(tableData);\r\n      let currentItem = menuList.find((item) => item.id === childId);\r\n      while (currentItem?.parentId) {\r\n        currentItem = menuList.find(\r\n          // eslint-disable-next-line no-loop-func\r\n          (item) => item.id === currentItem?.parentId\r\n        );\r\n\r\n        if (currentItem) currentItem.isAuth = true;\r\n      }\r\n      mutateTableData(deepCopy(tableData));\r\n    },\r\n    [tableData, mutateTableData]\r\n  );\r\n\r\n  // 菜单或目录上的checkbox改变时触发\r\n  const chechMenuChange = React.useCallback(\r\n    function (val: boolean, row: AuthMenu) {\r\n      const deep = function (item: AuthMenu) {\r\n        item.isAuth = val;\r\n        item.buttonList?.forEach((but) => {\r\n          but.isAuth = val;\r\n        });\r\n        item.children?.forEach((menu) => {\r\n          deep(menu);\r\n        });\r\n      };\r\n\r\n      if (val) selectParentMenu(row.id);\r\n\r\n      deep(row);\r\n\r\n      mutateTableData(deepCopy(tableData));\r\n    },\r\n    [selectParentMenu, mutateTableData, tableData]\r\n  );\r\n\r\n  // 处理功能标签check改变时\r\n  const handleFunCheckChange = React.useCallback(\r\n    function (row: AuthMenu) {\r\n      if ((row.buttonList || []).some((item) => item.isAuth === true)) {\r\n        row.isAuth = true;\r\n        selectParentMenu(row.id);\r\n      }\r\n      mutateTableData(deepCopy(tableData));\r\n    },\r\n    [selectParentMenu, mutateTableData, tableData]\r\n  );\r\n\r\n  const [submitLoading, setSubmitLoading] = useLoadingDelayAndKeep(false);\r\n  const onSubmit = React.useCallback(\r\n    function () {\r\n      setSubmitLoading.setTrue();\r\n      const result = treeMap(tableData, (item) => ({\r\n        id: item.id,\r\n        isAuth: item.isAuth,\r\n      }));\r\n\r\n      return authRole(result)\r\n        .then(() => {\r\n          setOpen(false);\r\n          props.callback();\r\n          message.success(\"更新成功！\");\r\n        })\r\n        .finally(() => setSubmitLoading.setFalse());\r\n    },\r\n    [tableData, message, props, setOpen, setSubmitLoading]\r\n  );\r\n\r\n  const columns = [\r\n    {\r\n      title: \"名称\",\r\n      dataIndex: \"title\",\r\n    },\r\n    {\r\n      title: \"类型\",\r\n      dataIndex: \"type\",\r\n      render: (type: AuthMenu[\"type\"]) => {\r\n        const map = menuType.map[type];\r\n        return <Tag color={map.color}>{map.label}</Tag>;\r\n      },\r\n      type: \"select\",\r\n      options: menuType.options,\r\n    },\r\n    {\r\n      title: \"按钮\",\r\n      dataIndex: \"buttonList\",\r\n      render: (buttonList: AuthMenu[\"buttonList\"], row: AuthMenu) => {\r\n        return buttonList?.map((item) => (\r\n          <Checkbox\r\n            key={item.id}\r\n            checked={item.isAuth}\r\n            onChange={(e) => {\r\n              item.isAuth = e.target.checked;\r\n              handleFunCheckChange(row);\r\n            }}\r\n          >\r\n            {item.name}\r\n          </Checkbox>\r\n        ));\r\n      },\r\n    },\r\n    {\r\n      title: (\r\n        <Checkbox\r\n          checked={checkAll}\r\n          indeterminate={indeterminate}\r\n          onChange={(e) => checkAllChange(e.target.checked)}\r\n        />\r\n      ),\r\n      key: \"action\",\r\n      render: (row: AuthMenu) => (\r\n        <Checkbox\r\n          checked={row.isAuth}\r\n          onChange={(e) => chechMenuChange(e.target.checked, row)}\r\n        />\r\n      ),\r\n    },\r\n  ];\r\n\r\n  React.useImperativeHandle(ref, () => ({\r\n    start: (roleId) => {\r\n      getTableData(roleId);\r\n      setOpen(true);\r\n    },\r\n  }));\r\n\r\n  return (\r\n    <Modal\r\n      title=\"角色授权\"\r\n      width={800}\r\n      open={open}\r\n      centered={true}\r\n      wrapClassName=\"custom-modal-style\"\r\n      maskClosable={false}\r\n      onOk={() => onSubmit()}\r\n      onCancel={() => setOpen(false)}\r\n      confirmLoading={submitLoading}\r\n    >\r\n      <Table\r\n        rowKey=\"id\"\r\n        size=\"small\"\r\n        dataSource={tableData}\r\n        columns={columns}\r\n        loading={loading}\r\n        pagination={false}\r\n        bordered\r\n      ></Table>\r\n    </Modal>\r\n  );\r\n});\r\n\r\n// 可以稍微减少使用时的代码量\r\nconst useModal: (props: Props) => [React.RefObject<Ref>, React.ReactElement] =\r\n  function (props) {\r\n    const ref = React.useRef<Ref>(null);\r\n\r\n    return [ref, <Accredit ref={ref} {...props} />];\r\n  };\r\n\r\nexport default createCompoundedComponent(Accredit, { useModal });\r\n","import { useRef } from \"react\";\r\nimport { Button, Space, App } from \"antd\";\r\nimport { PlusOutlined } from \"@ant-design/icons\";\r\nimport ProTable from \"@/components/ProTable\";\r\nimport OptimisticSwitch from \"@/components/OptimisticSwitch\";\r\nimport AddOrEdit from \"./AddOrEdit\";\r\nimport Accredit from \"./Accredit\";\r\nimport { roleEnabledState } from \"@/utils/dict\";\r\nimport { getRoleList, updateRoleStatusById, removeRole } from \"@/api/role\";\r\nimport PermissionControl, {\r\n  useFilterElementPermission,\r\n} from \"@/components/PermissionControl\";\r\n\r\nimport type { ProTableProps, Ref } from \"@/components/ProTable\";\r\nimport type { Role } from \"@/api/role\";\r\n\r\nexport default function Page() {\r\n  const { modal, message } = App.useApp();\r\n\r\n  const tableRef = useRef<Ref>(null);\r\n\r\n  const [addOrEditRef, addOrEditContext] = AddOrEdit.useModal({\r\n    callback: (pageIndex) => tableRef.current?.refresh(pageIndex),\r\n  });\r\n\r\n  const [accreditRef, accreditContext] = Accredit.useModal({\r\n    callback: () => tableRef.current?.refresh(),\r\n  });\r\n\r\n  // 表格的操作栏\r\n  const [actionRender, isShowAction] = useFilterElementPermission(\r\n    {\r\n      render: (row) => (\r\n        <Button\r\n          type=\"primary\"\r\n          ghost\r\n          size=\"small\"\r\n          onClick={() => addOrEditRef.current?.editStart(row)}\r\n        >\r\n          编辑\r\n        </Button>\r\n      ),\r\n      permission: \"edit\",\r\n    },\r\n    {\r\n      render: (row) => (\r\n        <Button\r\n          type=\"primary\"\r\n          size=\"small\"\r\n          style={{ background: \"#e6a23c\" }}\r\n          onClick={() => accreditRef.current?.start(row.id)}\r\n        >\r\n          授权\r\n        </Button>\r\n      ),\r\n      permission: \"accredit\",\r\n    },\r\n    {\r\n      render: (row) => (\r\n        <Button\r\n          type=\"primary\"\r\n          danger\r\n          size=\"small\"\r\n          onClick={() =>\r\n            modal.confirm({\r\n              title: \"提示\",\r\n              content: \"确定要删除此角色吗？\",\r\n              okType: \"danger\",\r\n              onOk: () =>\r\n                removeRole(row.id).then(() => message.success(\"删除成功！\")),\r\n              centered: true,\r\n            })\r\n          }\r\n        >\r\n          删除\r\n        </Button>\r\n      ),\r\n      permission: \"del\",\r\n    }\r\n  );\r\n\r\n  const columns: ProTableProps[\"columns\"] = [\r\n    {\r\n      title: \"角色名称\",\r\n      dataIndex: \"roleName\",\r\n    },\r\n    {\r\n      title: \"备注\",\r\n      dataIndex: \"description\",\r\n      hideInSearch: true,\r\n    },\r\n    {\r\n      title: \"状态\",\r\n      dataIndex: \"status\",\r\n      render: (status, row) => {\r\n        const { enabled, disabled } = roleEnabledState.enum;\r\n        return (\r\n          <OptimisticSwitch\r\n            defaultChecked={status === enabled}\r\n            onChange={(val) =>\r\n              updateRoleStatusById(\r\n                row.id,\r\n                val ? (enabled as Role[\"status\"]) : (disabled as Role[\"status\"])\r\n              ).then(() => {\r\n                // 如果觉得需要，也可以在此刷新表格\r\n                message.success(\"切换成功！\");\r\n              })\r\n            }\r\n          />\r\n        );\r\n      },\r\n      type: \"select\",\r\n      options: roleEnabledState.options,\r\n    },\r\n    {\r\n      title: \"操作\",\r\n      key: \"action\",\r\n      render: (row) => <Space>{actionRender(row)}</Space>,\r\n      width: 100,\r\n      fixed: \"right\",\r\n      hideInSearch: true,\r\n      hideInTable: !isShowAction,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <ProTable\r\n        ref={tableRef}\r\n        columns={columns}\r\n        rowKey=\"id\"\r\n        headerTitle=\"角色列表\"\r\n        request={(params, { current, pageSize }) =>\r\n          getRoleList(params, current, pageSize).then((value) => {\r\n            const { result: data } = value;\r\n            return {\r\n              list: data.records,\r\n              total: data.total,\r\n            };\r\n          })\r\n        }\r\n        toolBarRender={() => (\r\n          <PermissionControl permission=\"add\">\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={() => addOrEditRef.current?.addStart()}\r\n            >\r\n              新增\r\n            </Button>\r\n          </PermissionControl>\r\n        )}\r\n      />\r\n\r\n      {addOrEditContext}\r\n      {accreditContext}\r\n    </>\r\n  );\r\n}\r\n","/**\r\n * 通过文件地址获取文件名\r\n * @param {string} filePath 文件地址\r\n * @returns 文件名\r\n */\r\nexport const getFilenameFromPath = function (filePath: string) {\r\n  // 使用路径分隔符（/）来分割路径，并获取最后一个元素（文件名）\r\n  const parts = filePath.split(\"/\");\r\n  const filenameWithParams = parts[parts.length - 1];\r\n\r\n  // 查找文件名中的最后一个点\r\n  const lastDotIndex = filenameWithParams.lastIndexOf(\".\");\r\n\r\n  // 如果没有点或点在文件名的第一个字符位置，则返回原文件名\r\n  if (lastDotIndex <= 0) {\r\n    return filenameWithParams;\r\n  }\r\n\r\n  // 返回点之前的部分作为文件名\r\n  const filename = filenameWithParams.substring(0, lastDotIndex);\r\n\r\n  // 返回文件名加上后缀部分\r\n  const extension = filenameWithParams.substring(lastDotIndex);\r\n  return filename + extension;\r\n};\r\n\r\n// ================================ 分割线 ================================\r\n\r\n/**\r\n * 数据深拷贝\r\n * @param {any} obj - 需要深拷贝的对象或数组\r\n * @returns {any} - 深拷贝后的新对象或数组\r\n */\r\nexport const deepCopy = function <T extends any>(obj: T): T {\r\n  // 如果是基本数据类型或 null，则直接返回\r\n  if (typeof obj !== \"object\" || obj === null) {\r\n    return obj;\r\n  }\r\n\r\n  // 创建一个新对象或数组，根据原始对象的类型来判断\r\n  const newObj = (Array.isArray(obj) ? [] : {}) as T;\r\n\r\n  // 遍历原始对象的属性或数组元素\r\n  for (const key in obj) {\r\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n      // 递归调用深拷贝函数，复制属性值\r\n      newObj[key] = deepCopy(obj[key]);\r\n    }\r\n  }\r\n\r\n  return newObj;\r\n};\r\n\r\n// ================================ 分割线 ================================\r\n\r\ntype TreeNode = {\r\n  [key: string]: any;\r\n  children?: TreeNode[];\r\n};\r\n\r\n/**\r\n * 根据提供的函数 `predicate` 过滤树形结构。\r\n * 保留 `predicate` 返回 true 的节点，并保留那些有通过过滤的节点及其父节点。\r\n *\r\n * @param treeData - 需要过滤的树形结构数据。\r\n * @param predicate - 用于判断节点是否保留的函数。\r\n * @returns 过滤后的新树形结构。\r\n */\r\nexport const treeFilter = function (\r\n  /** 要过滤的树结构 */\r\n  treeData: TreeNode[] = [],\r\n  /** 该函数用于确定是否应保留节点 */\r\n  predicate: (node: TreeNode) => boolean\r\n): TreeNode[] {\r\n  // 深拷贝树形数据\r\n  const treeDataCopy = deepCopy(treeData);\r\n\r\n  // 递归过滤函数\r\n  const filterTree = (nodes: TreeNode[]): TreeNode[] => {\r\n    return nodes\r\n      .map((node) => {\r\n        // 递归过滤子节点\r\n        const children = filterTree(node.children || []);\r\n\r\n        // 检查当前节点是否通过过滤函数\r\n        if (predicate(node)) {\r\n          // 如果节点通过过滤，保留其过滤后的子节点（如果有的话）并返回节点\r\n          node.children = children.length > 0 ? children : undefined;\r\n          return node;\r\n        } else {\r\n          // 如果节点没有通过过滤，检查其子节点是否有通过过滤的\r\n          if (children && children.length > 0) {\r\n            node.children = children;\r\n            return node;\r\n          }\r\n          // 如果节点和其子节点都没有通过过滤，返回 null\r\n          return null;\r\n        }\r\n      })\r\n      .filter((node) => node !== null) as TreeNode[]; // 过滤掉返回 null 的节点\r\n  };\r\n\r\n  return filterTree(treeDataCopy);\r\n};\r\n\r\n// ================================ 分割线 ================================\r\n\r\n/**\r\n * 对树形结构的每个节点应用回调函数，并返回一个新的树形结构。\r\n * 类似于数组的 `map` 方法。\r\n *\r\n * @param treeData - 要遍历和转换的树形结构数据。\r\n * @param callback - 应用于每个节点的回调函数。\r\n * @returns 新的树形结构，节点经过回调函数的转换。\r\n */\r\nexport const treeMap = function (\r\n  treeData: TreeNode[] = [],\r\n  callback: (node: TreeNode) => TreeNode\r\n): TreeNode[] {\r\n  // 递归遍历和转换树的函数\r\n  const mapTree = (nodes: TreeNode[]): TreeNode[] => {\r\n    return nodes.map((node) => {\r\n      // 对当前节点应用回调函数\r\n      const newNode = callback({ ...node });\r\n\r\n      // 如果有子节点，递归应用回调函数\r\n      if (newNode.children && newNode.children.length > 0) {\r\n        newNode.children = mapTree(newNode.children);\r\n      }\r\n\r\n      return newNode;\r\n    });\r\n  };\r\n\r\n  return mapTree(treeData);\r\n};\r\n"],"names":["getMenuAll","axios","removeMenu","id","ModalForm","forwardRef","props","ref","title","width","submitText","cancelText","children","modalProps","formProps","onFinish","footer","initialValues","afterClose","open","set","setOpen","useBoolean","loading","setLoading","useLoadingDelayAndKeep","useImperativeHandle","close","_jsx","Modal","onCancel","_jsxs","Space","Button","onClick","type","form","submit","centered","wrapClassName","maskClosable","Form","autoComplete","values","fnResult","Promise","setTrue","then","finally","setFalse","layout","createCompoundedComponent","useModal","useRef","mainComponent","subComponents","Component","Object","keys","forEach","key","defineProperty","value","writable","enumerable","OptimisticSwitch","defaultChecked","onChange","checked","Switch","val","catch","AddOrEdit","React","message","App","setId","modalFormRef","formInstance","contextHolder","resetFields","data","apiUrl","successMsg","params","success","callback","undefined","_Fragment","name","label","rules","required","Input","placeholder","addStart","current","editStart","row","setFieldsValue","getRoleList","pageIndex","pageSize","updateRoleStatusById","status","removeRole","Accredit","tableData","mutate","mutateTableData","run","getTableData","useRequest","async","response","treeMap","result","item","isAuth","Mock","boolean","manual","checkAll","setCheckAll","indeterminate","setIndeterminate","isAuthAllList","deep","arr","push","buttonList","but","every","checkAllChange","deepCopy","selectParentMenu","childId","menuList","flattenDeepMenu","array","list","obj","parentId","currentItem","find","chechMenuChange","menu","handleFunCheckChange","some","submitLoading","setSubmitLoading","onSubmit","columns","dataIndex","render","map","menuType","Tag","color","options","Checkbox","e","target","start","roleId","onOk","confirmLoading","Table","rowKey","size","dataSource","pagination","bordered","Page","modal","tableRef","addOrEditRef","addOrEditContext","refresh","accreditRef","accreditContext","actionRender","isShowAction","useFilterElementPermission","ghost","permission","style","background","danger","confirm","content","okType","hideInSearch","enabled","disabled","roleEnabledState","fixed","hideInTable","ProTable","headerTitle","request","records","total","toolBarRender","PermissionControl","icon","PlusOutlined","getFilenameFromPath","filePath","parts","split","filenameWithParams","length","lastDotIndex","lastIndexOf","substring","newObj","Array","isArray","prototype","hasOwnProperty","call","treeFilter","treeData","predicate","treeDataCopy","filterTree","nodes","node","filter","mapTree","newNode"],"sourceRoot":""}