"use strict";(self.webpackChunkreact_admin_web=self.webpackChunkreact_admin_web||[]).push([[738],{60824:function(e,n,r){r.d(n,{S:function(){return l},n:function(){return s}});var t=r(95694);const l=()=>t.Z.get("/api/menu/all"),s=e=>t.Z.post("/api/menu/remove",{id:e})},10427:function(e,n,r){var t=r(54374),l=r(53725),s=r(68347),a=r(67557);const i=s;n.Z=function(e){const{dictName:n,placeholder:r="请选择",...s}=e,{options:o}=i[n];return(0,a.jsx)(t.default,{...s,placeholder:r,children:o.map((e=>(0,a.jsx)(t.default.Option,{value:e.value,children:e.color?(0,a.jsx)(l.Z,{color:e.color,text:e.label}):e.label},e.value)))})}},81375:function(e,n,r){var t=r(89526),l=r(20485),s=r(9740),a=r(74918),i=r(96799),o=r(5416),d=r(95267),c=r(49839),u=r(67557);const m=(0,t.forwardRef)((function(e,n){const{title:r,width:c,submitText:m="确定",cancelText:p="取消",children:h,modalProps:Z,formProps:x,onFinish:f,footer:j,initialValues:y,afterClose:b}=e,[g,{set:k}]=(0,l.Z)(!1),[v,C]=(0,d.ZP)(!1);return(0,t.useImperativeHandle)(n,(()=>({open:()=>k(!0),close:()=>k(!1)}))),(0,u.jsx)(s.Z,{title:r,open:g,onCancel:()=>k(!1),width:c,footer:j||(0,u.jsxs)(a.Z,{children:[(0,u.jsx)(i.ZP,{onClick:()=>k(!1),children:p}),(0,u.jsx)(i.ZP,{type:"primary",loading:v,onClick:()=>e.form?.submit(),children:m})]}),centered:!0,wrapClassName:"custom-modal-style",maskClosable:!1,afterClose:b,...Z,children:(0,u.jsx)(o.Z,{form:e.form,autoComplete:"off",onFinish:e=>{const n=f?.(e);n instanceof Promise&&(C.setTrue(),n.then((()=>k(!1))).finally((()=>C.setFalse())))},layout:"vertical",initialValues:y,...x,children:h})})}));n.Z=(0,c.Z)(m,{useModal:function(e){const n=(0,t.useRef)(null),[r]=o.Z.useForm();return[n,r,(0,u.jsx)(m,{ref:n,form:r,...e})]}})},49839:function(e,n,r){function t(e,n){const r=e;return Object.keys(n).forEach((e=>{Object.defineProperty(r,e,{value:n[e],writable:!1,enumerable:!0})})),r}r.d(n,{Z:function(){return t}})},80035:function(e,n,r){r.r(n),r.d(n,{default:function(){return q}});var t=r(89526),l=r(72816),s=r(96799),a=r(24059),i=r(16509),o=r(74918),d=r(31363),c=r(25877),u=r(60561),m=r(58047),p=r(68347),h=r(60824),Z=r(63953),x=r(5416),f=r(10011),j=r(53139),y=r(91117),b=r(95694),g=r(81375),k=r(10427),v=r(49839),C=r(17431);const I={pattern:/^\/[\w-/]*$/,message:"必须以斜杠开头，后跟字母、数字、下划线、中划线或斜杠"},w={pattern:/^[a-z][a-z0-9-]*$/,message:"只能是小写字母、中划线和数字组成，且必须以字母开头"};var T=r(67557);const P=t.forwardRef(((e,n)=>{const{message:r}=l.Z.useApp(),[a,i]=t.useState(""),c=t.useRef(null),[u]=x.Z.useForm(),m=x.Z.useWatch("type",u);return t.useImperativeHandle(n,(()=>({addStart:e=>{u.setFieldValue("parentId",e),c.current?.open()},editStart:e=>{i(e.id),u.setFieldsValue(e),c.current?.open()}}))),(0,T.jsxs)(g.Z,{ref:c,form:u,title:a?"编辑":"新增",width:800,afterClose:()=>{i(""),u.resetFields()},initialValues:{type:p.menuType.enum.menu},onFinish:n=>{const t=a?"/api/menu/update":"/api/menu/add",l=a?"更新成功！":"新增成功！",s=a?{id:a,...n}:n;return b.Z.post(t,s).then((()=>{r.success(l),e.callback(!a)}))},children:[(0,T.jsxs)(f.Z,{gutter:16,children:[(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(x.Z.Item,{label:"父节点",name:"parentId",required:!0,children:(0,T.jsx)(y.Z,{treeData:e.menuTreeAll,fieldNames:{label:"title",value:"id"},placeholder:"根节点",disabled:!0})})}),(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(x.Z.Item,{label:"名称",name:"title",rules:[{required:!0},{type:"string",min:2,max:10,message:"长度在 2 到 10 个字符！"}],children:(0,T.jsx)(d.Z,{placeholder:"菜单名称"})})}),(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(x.Z.Item,{label:"类型",name:"type",rules:[{required:!0}],children:(0,T.jsx)(k.Z,{placeholder:"菜单类型",dictName:"menuType"})})}),m===p.menuType.enum.menu&&(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(x.Z.Item,{label:"路径",name:"path",rules:[{required:!0},I],children:(0,T.jsx)(d.Z,{placeholder:"菜单路径"})})}),(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(x.Z.Item,{label:"图标",name:"icon",children:(0,T.jsx)(d.Z,{placeholder:"图标名称"})})})]}),m===p.menuType.enum.menu&&(0,T.jsx)(f.Z,{gutter:16,children:(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(x.Z.Item,{label:"按钮",children:(0,T.jsx)(x.Z.List,{name:"buttonList",children:(e,n)=>(0,T.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e.map((({key:e,name:r})=>(0,T.jsxs)(o.Z,{align:"baseline",children:[(0,T.jsx)(x.Z.Item,{name:[r,"name"],rules:[{required:!0,message:"按钮名称是必选字段"}],children:(0,T.jsx)(d.Z,{placeholder:"按钮名称"})}),(0,T.jsx)(x.Z.Item,{name:[r,"id"],rules:[{required:!0,message:"按钮标识是必选字段"},w],children:(0,T.jsx)(d.Z,{placeholder:"按钮标识"})}),(0,T.jsx)(C.Z,{onClick:()=>n.remove(r)})]},e))),(0,T.jsx)(s.ZP,{type:"dashed",onClick:()=>n.add(),block:!0,children:"+ 新增按钮"})]})})})})})]})}));var S=(0,v.Z)(P,{useModal:function(e){const n=t.useRef(null);return[n,(0,T.jsx)(P,{ref:n,...e})]}}),F=r(88238),R=r(26482);function q(){const{modal:e,message:n}=l.Z.useApp(),{data:r,loading:x,refresh:f}=(0,F.Z)((async()=>(await(0,h.S)()).result)),[j,y]=t.useState(),[b,g]=t.useState(),k=t.useMemo((()=>b?(0,R.Zm)(r,(e=>e.title.toLowerCase().includes(b.toLowerCase()))):r),[r,b]),[v,C]=S.useModal({menuTreeAll:r,callback:e=>{f(),e&&(g(void 0),y(void 0))}}),[I,w]=(0,Z.Fu)({render:e=>(0,T.jsx)(s.ZP,{type:"primary",ghost:!0,size:"small",onClick:()=>v.current?.editStart(e),children:"编辑"}),permission:"edit"},{render:e=>(0,T.jsx)(s.ZP,{type:"primary",size:"small",onClick:()=>v.current?.addStart(e.id),children:"新增下级"}),permission:"add"},{render:r=>(0,T.jsx)(s.ZP,{type:"primary",danger:!0,size:"small",onClick:()=>e.confirm({title:"提示",content:"确定要删除此菜单及其子菜单吗？",okType:"danger",onOk:()=>(0,h.n)(r.id).then((()=>{n.success("删除成功！"),f()})),centered:!0}),children:"删除"}),permission:"del"}),{token:{colorError:P}}=a.Z.useToken(),q=t.useCallback((function(e,n){if(!n)return e;const r=new RegExp(`(${n})`,"gi");return e.replace(r,`<span style="color:${P}">$1</span>`)}),[P]),L=[{title:"名称",dataIndex:"title",render:e=>(0,T.jsx)("div",{dangerouslySetInnerHTML:{__html:q(e,b||"")}}),width:300},{title:"路径",dataIndex:"path"},{title:"图标",dataIndex:"icon",hideInSearch:!0},{title:"类型",dataIndex:"type",render:e=>{const n=p.menuType.map[e];return(0,T.jsx)(i.Z,{color:n.color,children:n.label})},type:"select",options:p.menuType.options},{title:"按钮",dataIndex:"buttonList",render:e=>e?.map((e=>(0,T.jsx)(i.Z,{color:"#2db7f5",children:e.name},e.id)))},{title:"操作",key:"action",render:e=>(0,T.jsx)(o.Z,{children:I(e)}),width:100,fixed:"right",hideInSearch:!0,hideInTable:!w}];return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(c.Z,{rowKey:"id",dataSource:k,search:!1,columns:L,headerTitle:"菜单列表",toolBarRender:(0,T.jsxs)(o.Z,{children:[(0,T.jsx)(d.Z,{value:j,prefix:(0,T.jsx)(u.Z,{}),placeholder:"输入菜单名称查询",style:{width:200},onChange:e=>y(e.target.value),onPressEnter:()=>g(j)}),(0,T.jsx)(Z.ZP,{permission:"add",children:(0,T.jsx)(s.ZP,{type:"primary",icon:(0,T.jsx)(m.Z,{}),onClick:()=>v.current?.addStart(),children:"新增"})})]}),pagination:!1,loading:x,onRefresh:()=>f()}),C]})}},53139:function(e,n,r){var t=r(78944);n.Z=t.Z},10011:function(e,n,r){var t=r(1308);n.Z=t.Z}}]);
//# sourceMappingURL=738.0ecb89c7.chunk.js.map