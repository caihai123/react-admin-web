"use strict";(self.webpackChunkreact_admin_web=self.webpackChunkreact_admin_web||[]).push([[674],{60824:function(e,t,n){n.d(t,{S:function(){return s},n:function(){return a}});var r=n(95694);const s=()=>r.Z.get("/api/menu/all"),a=e=>r.Z.post("/api/menu/remove",{id:e})},99375:function(e,t,n){n.d(t,{GG:function(){return a},JV:function(){return s},fs:function(){return o},l5:function(){return i},sv:function(){return c}});var r=n(95694);const s=(e,t=1,n=10)=>r.Z.post("/api/role/page",{params:e,pageIndex:t,pageSize:n}),a=(e,t)=>r.Z.post("/api/role/status/update",{id:e,status:t}),i=e=>r.Z.post("/api/role/remove",{id:e}),o=e=>r.Z.post("/api/role/auth",e),c=()=>r.Z.get("/api/role/select")},81375:function(e,t,n){var r=n(89526),s=n(20485),a=n(9740),i=n(74918),o=n(96799),c=n(5416),l=n(95267),u=n(49839),d=n(67557);const h=(0,r.forwardRef)((function(e,t){const{title:n,width:u,submitText:h="确定",cancelText:f="取消",children:p,modalProps:m,formProps:Z,onFinish:x,footer:k,initialValues:b,afterClose:g}=e,[j,{set:y}]=(0,s.Z)(!1),[C,A]=(0,l.ZP)(!1);return(0,r.useImperativeHandle)(t,(()=>({open:()=>y(!0),close:()=>y(!1)}))),(0,d.jsx)(a.Z,{title:n,open:j,onCancel:()=>y(!1),width:u,footer:k||(0,d.jsxs)(i.Z,{children:[(0,d.jsx)(o.ZP,{onClick:()=>y(!1),children:f}),(0,d.jsx)(o.ZP,{type:"primary",loading:C,onClick:()=>e.form?.submit(),children:h})]}),centered:!0,wrapClassName:"custom-modal-style",maskClosable:!1,afterClose:g,...m,children:(0,d.jsx)(c.Z,{form:e.form,autoComplete:"off",onFinish:e=>{const t=x?.(e);t instanceof Promise&&(A.setTrue(),t.then((()=>y(!1))).finally((()=>A.setFalse())))},layout:"vertical",initialValues:b,...Z,children:p})})}));t.Z=(0,u.Z)(h,{useModal:function(e){const t=(0,r.useRef)(null),[n]=c.Z.useForm();return[t,n,(0,d.jsx)(h,{ref:t,form:n,...e})]}})},9346:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(20485),s=n(49367),a=n(95267),i=n(67557);function o({defaultChecked:e=!1,onChange:t=(()=>null)}){const[n,{set:o}]=(0,r.Z)(e),[c,{setTrue:l,setFalse:u}]=(0,a.ZP)(!1);return(0,i.jsx)(s.Z,{checked:n,loading:c,onChange:e=>{o(e),l(),t(e)?.catch((()=>{o(!e)})).finally((()=>u()))}})}},49839:function(e,t,n){function r(e,t){const n=e;return Object.keys(t).forEach((e=>{Object.defineProperty(n,e,{value:t[e],writable:!1,enumerable:!0})})),n}n.d(t,{Z:function(){return r}})},61297:function(e,t,n){n.r(t),n.d(t,{default:function(){return L}});var r=n(89526),s=n(72816),a=n(96799),i=n(74918),o=n(58047),c=n(25877),l=n(9346),u=n(5416),d=n(31363),h=n(95694),f=n(81375),p=n(49839),m=n(67557);const Z=r.forwardRef(((e,t)=>{const{message:n}=s.Z.useApp(),[a,i]=r.useState(""),[o,c,l]=f.Z.useModal({title:a?"编辑":"新增",width:600,afterClose:()=>{i(""),c?.resetFields()},onFinish:function(t){const r=a?"/api/role/update":"/api/role/add",s=a?"更新成功！":"新增成功！",i=a?{id:a,...t}:t;return h.Z.post(r,i).then((()=>{n.success(s),e.callback(a?void 0:1)}))},children:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(u.Z.Item,{name:"roleName",label:"角色名称",rules:[{required:!0,message:"请填写角色名称"}],children:(0,m.jsx)(d.Z,{placeholder:"请输入"})}),(0,m.jsx)(u.Z.Item,{name:"description",label:"备注",children:(0,m.jsx)(d.Z.TextArea,{placeholder:"请输入"})})]})});return r.useImperativeHandle(t,(()=>({addStart:()=>o.current?.open(),editStart:e=>{i(e.id),c?.setFieldsValue(e),o.current?.open()}}))),l}));var x=(0,p.Z)(Z,{useModal:function(e){const t=r.useRef(null);return[t,(0,m.jsx)(Z,{ref:t,...e})]}}),k=n(16509),b=n(59827),g=n(9740),j=n(95810),y=n(20485),C=n(88238),A=n(60824),I=n(99375),v=n(68347),w=n(22701),S=n(26482),P=n(95267),T=n(50706),E=n.n(T);const F=r.forwardRef(((e,t)=>{const[n,{set:a}]=(0,y.Z)(!1),{message:i}=s.Z.useApp(),{data:o,loading:c,mutate:l,run:u}=(0,C.Z)((async e=>{const t=await(0,A.S)();return(0,S.ff)(t.result,(({children:e,...t})=>({...t,isAuth:E().mock({"boolean|1-2":!1}).boolean})))}),{manual:!0}),[d,h]=r.useState(!1),[f,p]=r.useState(!1);r.useEffect((()=>{const e=[],t=function(n=[]){n.forEach((n=>{e.push(n.isAuth),n.buttonList?.forEach((t=>{e.push(t.isAuth)})),t(n.children)}))};t(o),e.every((e=>!0===e))?(h(!0),p(!1)):e.every((e=>!0!==e))?(h(!1),p(!1)):(h(!1),p(!0))}),[o]);const Z=r.useCallback((function(e){const t=function(n=[]){n.forEach((n=>{n.isAuth=e,n.buttonList?.forEach((t=>{t.isAuth=e})),t(n.children)}))};t(o),l((0,w.p)(o))}),[o,l]),x=r.useCallback((function(e){const t=((e=[])=>{const t=[],n=function(e,r){t.push(e),(e.children||[]).forEach((t=>n(t,e.id)))};return e.forEach((e=>n(e,""))),t})(o);let n=t.find((t=>t.id===e));for(;n?.parentId;)n=t.find((e=>e.id===n?.parentId)),n&&(n.isAuth=!0);l((0,w.p)(o))}),[o,l]),T=r.useCallback((function(e,t){const n=function(t){t.isAuth=e,t.buttonList?.forEach((t=>{t.isAuth=e})),t.children?.forEach((e=>{n(e)}))};e&&x(t.id),n(t),l((0,w.p)(o))}),[x,l,o]),F=r.useCallback((function(e){(e.buttonList||[]).some((e=>!0===e.isAuth))&&(e.isAuth=!0,x(e.id)),l((0,w.p)(o))}),[x,l,o]),[R,z]=(0,P.ZP)(!1),L=r.useCallback((function(){z.setTrue();const t=(0,S.ff)(o,(e=>({id:e.id,isAuth:e.isAuth})));return(0,I.fs)(t).then((()=>{a(!1),e.callback(),i.success("更新成功！")})).finally((()=>z.setFalse()))}),[o,i,e,a,z]),M=[{title:"名称",dataIndex:"title"},{title:"类型",dataIndex:"type",render:e=>{const t=v.menuType.map[e];return(0,m.jsx)(k.Z,{color:t.color,children:t.label})},type:"select",options:v.menuType.options},{title:"按钮",dataIndex:"buttonList",render:(e,t)=>e?.map((e=>(0,m.jsx)(b.Z,{checked:e.isAuth,onChange:n=>{e.isAuth=n.target.checked,F(t)},children:e.name},e.id)))},{title:(0,m.jsx)(b.Z,{checked:d,indeterminate:f,onChange:e=>Z(e.target.checked)}),key:"action",render:e=>(0,m.jsx)(b.Z,{checked:e.isAuth,onChange:t=>T(t.target.checked,e)})}];return r.useImperativeHandle(t,(()=>({start:e=>{u(e),a(!0)}}))),(0,m.jsx)(g.Z,{title:"角色授权",width:800,open:n,centered:!0,wrapClassName:"custom-modal-style",maskClosable:!1,onOk:()=>L(),onCancel:()=>a(!1),confirmLoading:R,okText:"保存",children:(0,m.jsx)(j.Z,{rowKey:"id",size:"small",dataSource:o,columns:M,loading:c,pagination:!1,bordered:!0})})}));var R=(0,p.Z)(F,{useModal:function(e){const t=r.useRef(null);return[t,(0,m.jsx)(F,{ref:t,...e})]}}),z=n(63953);function L(){const{modal:e,message:t}=s.Z.useApp(),n=(0,r.useRef)(null),[u,d]=x.useModal({callback:e=>n.current?.refresh(e)}),[h,f]=R.useModal({callback:()=>n.current?.refresh()}),[p,Z]=(0,z.Fu)({render:e=>(0,m.jsx)(a.ZP,{type:"primary",ghost:!0,size:"small",onClick:()=>u.current?.editStart(e),children:"编辑"}),permission:"edit"},{render:e=>(0,m.jsx)(a.ZP,{type:"primary",size:"small",style:{background:"#e6a23c"},onClick:()=>h.current?.start(e.id),children:"授权"}),permission:"accredit"},{render:r=>(0,m.jsx)(a.ZP,{type:"primary",danger:!0,size:"small",onClick:()=>e.confirm({title:"提示",content:"确定要删除此角色吗？",okType:"danger",onOk:()=>(0,I.l5)(r.id).then((()=>{t.success("删除成功！"),n.current?.refresh()})),centered:!0}),children:"删除"}),permission:"del"}),k=[{title:"角色名称",dataIndex:"roleName"},{title:"备注",dataIndex:"description",hideInSearch:!0},{title:"状态",dataIndex:"status",render:(e,n)=>{const{enabled:r,disabled:s}=v.roleEnabledState.enum;return(0,m.jsx)(l.Z,{defaultChecked:e===r,onChange:e=>(0,I.GG)(n.id,e?r:s).then((()=>{t.success("切换成功！")}))})},type:"select",options:v.roleEnabledState.options},{title:"创建时间",dataIndex:"createTime",hideInSearch:!0},{title:"操作",key:"action",render:e=>(0,m.jsx)(i.Z,{children:p(e)}),width:100,fixed:"right",hideInSearch:!0,hideInTable:!Z}];return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c.Z,{ref:n,columns:k,rowKey:"id",headerTitle:"角色列表",request:(e,{current:t,pageSize:n})=>(0,I.JV)(e,t,n).then((e=>{const{result:t}=e;return{list:t.records,total:t.total}})),toolBarRender:()=>(0,m.jsx)(z.ZP,{permission:"add",children:(0,m.jsx)(a.ZP,{type:"primary",icon:(0,m.jsx)(o.Z,{}),onClick:()=>u.current?.addStart(),children:"新增"})})}),d,f]})}}}]);
//# sourceMappingURL=674.0af07df5.chunk.js.map