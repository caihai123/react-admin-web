{"version":3,"file":"static/js/836.d3be0c6d.chunk.js","mappings":"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","sources":["webpack://react-admin-web/./node_modules/antd/es/modal/PurePanel.js","webpack://react-admin-web/./node_modules/antd/es/modal/index.js","webpack://react-admin-web/./src/components/ModalForm.tsx","webpack://react-admin-web/./src/components/utils/createCompoundedComponent.ts","webpack://react-admin-web/./src/components/OptimisticSwitch.tsx","webpack://react-admin-web/./src/pages/system/role/AddOrEdit.tsx","webpack://react-admin-web/./src/api/role.ts","webpack://react-admin-web/./src/pages/system/role/index.tsx"],"sourcesContent":["\"use client\";\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n/* eslint-disable react/jsx-no-useless-fragment */\nimport * as React from 'react';\nimport classNames from 'classnames';\nimport { Panel } from 'rc-dialog';\nimport { withPureRenderTheme } from '../_util/PurePanel';\nimport { ConfigContext } from '../config-provider';\nimport { ConfirmContent } from './ConfirmDialog';\nimport { Footer, renderCloseIcon } from './shared';\nimport useStyle from './style';\nimport useCSSVarCls from '../config-provider/hooks/useCSSVarCls';\nconst PurePanel = props => {\n  const {\n      prefixCls: customizePrefixCls,\n      className,\n      closeIcon,\n      closable,\n      type,\n      title,\n      children,\n      footer\n    } = props,\n    restProps = __rest(props, [\"prefixCls\", \"className\", \"closeIcon\", \"closable\", \"type\", \"title\", \"children\", \"footer\"]);\n  const {\n    getPrefixCls\n  } = React.useContext(ConfigContext);\n  const rootPrefixCls = getPrefixCls();\n  const prefixCls = customizePrefixCls || getPrefixCls('modal');\n  const rootCls = useCSSVarCls(rootPrefixCls);\n  const [wrapCSSVar, hashId, cssVarCls] = useStyle(prefixCls, rootCls);\n  const confirmPrefixCls = `${prefixCls}-confirm`;\n  // Choose target props by confirm mark\n  let additionalProps = {};\n  if (type) {\n    additionalProps = {\n      closable: closable !== null && closable !== void 0 ? closable : false,\n      title: '',\n      footer: '',\n      children: ( /*#__PURE__*/React.createElement(ConfirmContent, Object.assign({}, props, {\n        prefixCls: prefixCls,\n        confirmPrefixCls: confirmPrefixCls,\n        rootPrefixCls: rootPrefixCls,\n        content: children\n      })))\n    };\n  } else {\n    additionalProps = {\n      closable: closable !== null && closable !== void 0 ? closable : true,\n      title,\n      footer: footer !== null && /*#__PURE__*/React.createElement(Footer, Object.assign({}, props)),\n      children\n    };\n  }\n  return wrapCSSVar( /*#__PURE__*/React.createElement(Panel, Object.assign({\n    prefixCls: prefixCls,\n    className: classNames(hashId, `${prefixCls}-pure-panel`, type && confirmPrefixCls, type && `${confirmPrefixCls}-${type}`, className, cssVarCls, rootCls)\n  }, restProps, {\n    closeIcon: renderCloseIcon(prefixCls, closeIcon),\n    closable: closable\n  }, additionalProps)));\n};\nexport default withPureRenderTheme(PurePanel);","\"use client\";\n\nimport confirm, { modalGlobalConfig, withConfirm, withError, withInfo, withSuccess, withWarn } from './confirm';\nimport destroyFns from './destroyFns';\nimport OriginModal from './Modal';\nimport PurePanel from './PurePanel';\nimport useModal from './useModal';\nfunction modalWarn(props) {\n  return confirm(withWarn(props));\n}\nconst Modal = OriginModal;\nModal.useModal = useModal;\nModal.info = function infoFn(props) {\n  return confirm(withInfo(props));\n};\nModal.success = function successFn(props) {\n  return confirm(withSuccess(props));\n};\nModal.error = function errorFn(props) {\n  return confirm(withError(props));\n};\nModal.warning = modalWarn;\nModal.warn = modalWarn;\nModal.confirm = function confirmFn(props) {\n  return confirm(withConfirm(props));\n};\nModal.destroyAll = function destroyAllFn() {\n  while (destroyFns.length) {\n    const close = destroyFns.pop();\n    if (close) {\n      close();\n    }\n  }\n};\nModal.config = modalGlobalConfig;\nModal._InternalPanelDoNotUseOrYouWillBeFired = PurePanel;\nif (process.env.NODE_ENV !== 'production') {\n  Modal.displayName = 'Modal';\n}\nexport default Modal;","import { forwardRef, useImperativeHandle, useRef } from \"react\";\r\nimport { useBoolean } from \"ahooks\";\r\nimport { Modal, Form, Space, Button } from \"antd\";\r\nimport useLoadingDelayAndKeep from \"@/hooks/useLoadingDelayAndKeep\";\r\nimport createCompoundedComponent from \"./utils/createCompoundedComponent\";\r\n\r\nimport type { ReactNode, RefObject, ReactElement } from \"react\";\r\nimport type { ModalProps, FormProps } from \"antd\";\r\n\r\nexport type Ref = {\r\n  /** 打开 Modal */\r\n  open: () => void;\r\n  /** 关闭 Modal */\r\n  close: () => void;\r\n};\r\n\r\nexport type Props = {\r\n  /** 表单内容 */\r\n  children?: ReactNode;\r\n  /** Drawer title */\r\n  title?: ModalProps[\"title\"];\r\n  /** Drawer width */\r\n  width?: ModalProps[\"width\"];\r\n  /** 确认按钮文字 默认：确定 */\r\n  submitText?: ReactNode;\r\n  /** 取消按钮文字 默认：取消 */\r\n  cancelText?: ReactNode;\r\n  /** 提交表单后触发的事件 */\r\n  onFinish?: ((values: any) => void | Promise<any>) | undefined;\r\n  /** Drawer 底部内容，当不需要默认底部按钮时，可以设为 footer={null} 默认：确定取消按钮 */\r\n  footer?: ModalProps[\"footer\"];\r\n  /** 表单默认值 */\r\n  initialValues?: FormProps[\"initialValues\"];\r\n  form: FormProps[\"form\"];\r\n  // Modal 完全关闭后的回调\r\n  afterClose?: ModalProps[\"afterClose\"];\r\n  /** Modal 其他属性 优先级较高，可能会覆盖title，width等属性 */\r\n  modalProps?: ModalProps;\r\n  /** Form 其他属性 优先级较高，可能会覆盖onFinish，initialValues等属性 */\r\n  formProps?: FormProps;\r\n};\r\n\r\n/**\r\n * Modal 和 Form 的组合，方便在 Modal 中快速创建表单\r\n */\r\nconst ModalForm = forwardRef<Ref, Props>(function (props, ref) {\r\n  const {\r\n    title,\r\n    width,\r\n    submitText = \"确定\",\r\n    cancelText = \"取消\",\r\n    children,\r\n    modalProps,\r\n    formProps,\r\n    onFinish,\r\n    footer,\r\n    initialValues,\r\n    afterClose,\r\n  } = props;\r\n\r\n  const [open, { set: setOpen }] = useBoolean(false);\r\n\r\n  const [loading, setLoading] = useLoadingDelayAndKeep(false);\r\n\r\n  useImperativeHandle(ref, () => ({\r\n    open: () => setOpen(true),\r\n    close: () => setOpen(false),\r\n  }));\r\n\r\n  return (\r\n    <Modal\r\n      title={title}\r\n      open={open}\r\n      onCancel={() => setOpen(false)}\r\n      width={width}\r\n      footer={\r\n        footer ? (\r\n          footer\r\n        ) : (\r\n          <Space>\r\n            <Button onClick={() => setOpen(false)}>{cancelText}</Button>\r\n            <Button\r\n              type=\"primary\"\r\n              loading={loading}\r\n              onClick={() => props.form?.submit()}\r\n            >\r\n              {submitText}\r\n            </Button>\r\n          </Space>\r\n        )\r\n      }\r\n      centered={true}\r\n      wrapClassName=\"custom-modal-style\"\r\n      maskClosable={false}\r\n      // style={{ marginTop: \"-20vh\" }}\r\n      afterClose={afterClose}\r\n      {...modalProps}\r\n    >\r\n      <Form\r\n        form={props.form}\r\n        autoComplete=\"off\"\r\n        onFinish={(values) => {\r\n          const fnResult = onFinish?.(values);\r\n          if (fnResult instanceof Promise) {\r\n            setLoading.setTrue();\r\n            fnResult\r\n              .then(() => setOpen(false))\r\n              .finally(() => setLoading.setFalse());\r\n          }\r\n        }}\r\n        layout=\"vertical\"\r\n        initialValues={initialValues}\r\n        {...formProps}\r\n      >\r\n        {children}\r\n      </Form>\r\n    </Modal>\r\n  );\r\n});\r\n\r\n// 帮你创建 ref 和 form，可以稍微减少使用时的代码量\r\nconst useModal: (\r\n  props: Omit<Props, \"form\">\r\n) => [RefObject<Ref>, FormProps[\"form\"], ReactElement] = function (props) {\r\n  const ref = useRef<Ref>(null);\r\n  const [form] = Form.useForm();\r\n\r\n  return [ref, form, <ModalForm ref={ref} form={form} {...props} />];\r\n};\r\n\r\nexport default createCompoundedComponent(ModalForm, {\r\n  useModal,\r\n});\r\n","import React from \"react\";\r\n\r\n// 定义子组件的类型\r\ninterface SubComponents {\r\n  [key: string]: any;\r\n}\r\n\r\n// 主组件和子组件的组合类型\r\ntype CompoundedComponent<F, T> = F & T;\r\n\r\n/**\r\n * 创建组合组件\r\n */\r\nexport default function createCompoundedComponent<\r\n  F extends React.FC<any>,\r\n  T extends SubComponents\r\n>(mainComponent: F, subComponents: T): CompoundedComponent<F, T> {\r\n  // 将主组件转换为复合组件类型\r\n  const Component = mainComponent as CompoundedComponent<F, T>;\r\n\r\n  // 使用 Object.defineProperty 添加子组件到主组件上\r\n  Object.keys(subComponents).forEach((key) => {\r\n    Object.defineProperty(Component, key, {\r\n      value: subComponents[key],\r\n      writable: false, // 确保子组件不可变\r\n      enumerable: true,\r\n    });\r\n  });\r\n\r\n  return Component;\r\n}\r\n","import { useBoolean } from \"ahooks\";\r\nimport { Switch } from \"antd\";\r\nimport useLoadingDelayAndKeep from \"@/hooks/useLoadingDelayAndKeep\";\r\n\r\n// 切换失败时自动撤销的 Optimistic Updates 开关\r\n// 注意：暂时还没完全想清楚此组件要不要作为公共基础组件存在\r\n\r\ntype Props = {\r\n  defaultChecked: boolean;\r\n  onChange: (val: boolean) => Promise<any> | null | undefined;\r\n};\r\n\r\nexport default function OptimisticSwitch({\r\n  defaultChecked = false,\r\n  onChange = () => null,\r\n}: Props) {\r\n  const [checked, { set }] = useBoolean(defaultChecked);\r\n  const [loading, { setTrue, setFalse }] = useLoadingDelayAndKeep(false);\r\n\r\n  return (\r\n    <Switch\r\n      checked={checked}\r\n      loading={loading}\r\n      onChange={(val) => {\r\n        set(val);\r\n        setTrue();\r\n        onChange(val)\r\n          ?.catch(() => {\r\n            set(!val);\r\n          })\r\n          .finally(() => setFalse());\r\n      }}\r\n    ></Switch>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { Form, Input, App } from \"antd\";\r\nimport axios from \"@/utils/axios\";\r\nimport ModalForm from \"@/components/ModalForm\";\r\nimport { Role } from \"@/api/role\";\r\nimport createCompoundedComponent from \"@/components/utils/createCompoundedComponent\";\r\n\r\nexport type Props = {\r\n  callback: (pageIndex?: number) => void;\r\n};\r\nexport type Ref = {\r\n  addStart: () => void;\r\n  editStart: (row: Role) => void;\r\n};\r\n\r\nconst AddOrEdit = React.forwardRef<Ref, Props>((props, ref) => {\r\n  const { message } = App.useApp();\r\n\r\n  const [id, setId] = React.useState(\"\");\r\n\r\n  const onSubmit = function (data: Pick<Role, \"roleName\" | \"description\">) {\r\n    const apiUrl = id ? \"/api/role/update\" : \"/api/role/add\";\r\n    const successMsg = id ? \"更新成功！\" : \"新增成功！\";\r\n    const params = id ? { id, ...data } : data;\r\n    const callback = () => props.callback(id ? undefined : 1);\r\n    return axios.post(apiUrl, params).then(() => {\r\n      message.success(successMsg);\r\n      callback();\r\n    });\r\n  };\r\n\r\n  const [modalFormRef, formInstance, contextHolder] = ModalForm.useModal({\r\n    title: id ? \"编辑\" : \"新增\",\r\n    width: 600,\r\n    afterClose: () => {\r\n      setId(\"\");\r\n      formInstance?.resetFields();\r\n    },\r\n    onFinish: onSubmit,\r\n    children: (\r\n      <>\r\n        <Form.Item\r\n          name=\"roleName\"\r\n          label=\"角色名称\"\r\n          rules={[{ required: true, message: \"请填写角色名称\" }]}\r\n        >\r\n          <Input placeholder=\"请输入\" />\r\n        </Form.Item>\r\n        <Form.Item name=\"description\" label=\"备注\">\r\n          <Input.TextArea placeholder=\"请输入\" />\r\n        </Form.Item>\r\n      </>\r\n    ),\r\n  });\r\n\r\n  React.useImperativeHandle(ref, () => ({\r\n    addStart: () => modalFormRef.current?.open(),\r\n    editStart: (row) => {\r\n      setId(row.id);\r\n      formInstance?.setFieldsValue(row);\r\n      modalFormRef.current?.open();\r\n    },\r\n  }));\r\n\r\n  return contextHolder;\r\n});\r\n\r\n// 可以稍微减少使用时的代码量\r\nconst useModal: (props: Props) => [React.RefObject<Ref>, React.ReactElement] =\r\n  function (props) {\r\n    const ref = React.useRef<Ref>(null);\r\n\r\n    return [ref, <AddOrEdit ref={ref} {...props} />];\r\n  };\r\n\r\nexport default createCompoundedComponent(AddOrEdit, { useModal });\r\n","/* eslint-disable import/prefer-default-export */\r\nimport axios from \"@/utils/axios\";\r\nimport { roleEnabledState } from \"@/utils/dict\";\r\n\r\nimport type { AxiosResultPromise } from \"@/utils/axios\";\r\n\r\nexport type Role = {\r\n  id: string;\r\n  roleName: string;\r\n  description: string;\r\n  status: (typeof roleEnabledState.options)[number][\"value\"];\r\n};\r\n\r\n/** 分页获取角色列表*/\r\nexport const getRoleList: (\r\n  params: any,\r\n  pageIndex: number,\r\n  pageSize: number\r\n) => AxiosResultPromise<{\r\n  records: Role[];\r\n  total: number;\r\n  pageIndex: number;\r\n}> = (params, pageIndex = 1, pageSize = 10) => {\r\n  return axios.post(\"/api/role/page\", { params, pageIndex, pageSize });\r\n};\r\n\r\n// 通过id更新角色状态\r\nexport const updateRoleStatusById: (\r\n  id: Role[\"id\"],\r\n  status: Role[\"status\"]\r\n) => AxiosResultPromise<any> = (id, status) => {\r\n  return axios.post(\"/api/role/status/update\", { id, status });\r\n};\r\n","import { useRef } from \"react\";\r\nimport { Button, Space, App } from \"antd\";\r\nimport { PlusOutlined } from \"@ant-design/icons\";\r\nimport ProTable from \"@/components/ProTable\";\r\nimport OptimisticSwitch from \"@/components/OptimisticSwitch\";\r\nimport AddOrEdit from \"./AddOrEdit\";\r\nimport { roleEnabledState } from \"@/utils/dict\";\r\nimport { getRoleList, updateRoleStatusById } from \"@/api/role\";\r\nimport PermissionControl, {\r\n  useFilterElementPermission,\r\n} from \"@/components/PermissionControl\";\r\n\r\nimport type { ProTableProps, Ref } from \"@/components/ProTable\";\r\nimport type { Role } from \"@/api/role\";\r\n\r\nexport default function Page() {\r\n  const { message } = App.useApp();\r\n\r\n  const tableRef = useRef<Ref>(null);\r\n\r\n  const [addOrEditRef, contextHolder] = AddOrEdit.useModal({\r\n    callback: (pageIndex) => tableRef.current?.refresh(pageIndex),\r\n  });\r\n\r\n  // 表格的操作栏\r\n  const [actionRender, isShowAction] = useFilterElementPermission(\r\n    {\r\n      render: (row) => (\r\n        <Button\r\n          type=\"primary\"\r\n          ghost\r\n          size=\"small\"\r\n          onClick={() => addOrEditRef.current?.editStart(row)}\r\n        >\r\n          编辑\r\n        </Button>\r\n      ),\r\n      permission: \"edit\",\r\n    },\r\n    {\r\n      render: (row) => (\r\n        <Button type=\"primary\" size=\"small\">\r\n          授权\r\n        </Button>\r\n      ),\r\n      permission: \"accredit\",\r\n    },\r\n    {\r\n      render: (row) => (\r\n        <Button type=\"primary\" danger size=\"small\">\r\n          删除\r\n        </Button>\r\n      ),\r\n      permission: \"del\",\r\n    }\r\n  );\r\n\r\n  const columns: ProTableProps[\"columns\"] = [\r\n    {\r\n      title: \"角色名称\",\r\n      dataIndex: \"roleName\",\r\n    },\r\n    {\r\n      title: \"备注\",\r\n      dataIndex: \"description\",\r\n      hideInSearch: true,\r\n    },\r\n    {\r\n      title: \"状态\",\r\n      dataIndex: \"status\",\r\n      render: (status, row) => {\r\n        const { enabled, disabled } = roleEnabledState.enum;\r\n        return (\r\n          <OptimisticSwitch\r\n            defaultChecked={status === enabled}\r\n            onChange={(val) =>\r\n              updateRoleStatusById(\r\n                row.id,\r\n                val ? (enabled as Role[\"status\"]) : (disabled as Role[\"status\"])\r\n              ).then(() => {\r\n                // 如果觉得需要，也可以在此刷新表格\r\n                message.success(\"切换成功！\");\r\n              })\r\n            }\r\n          />\r\n        );\r\n      },\r\n      type: \"select\",\r\n      options: roleEnabledState.options,\r\n    },\r\n    {\r\n      title: \"操作\",\r\n      key: \"action\",\r\n      render: (row) => <Space>{actionRender(row)}</Space>,\r\n      width: 100,\r\n      fixed: \"right\",\r\n      hideInSearch: true,\r\n      hideInTable: !isShowAction,\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <>\r\n      <ProTable\r\n        ref={tableRef}\r\n        columns={columns}\r\n        rowKey=\"id\"\r\n        headerTitle=\"角色列表\"\r\n        request={(params, { current, pageSize }) =>\r\n          getRoleList(params, current, pageSize).then((value) => {\r\n            const { result: data } = value;\r\n            return {\r\n              list: data.records,\r\n              total: data.total,\r\n            };\r\n          })\r\n        }\r\n        toolBarRender={() => (\r\n          <PermissionControl permission=\"add\">\r\n            <Button\r\n              type=\"primary\"\r\n              icon={<PlusOutlined />}\r\n              onClick={() => addOrEditRef.current?.addStart()}\r\n            >\r\n              新增\r\n            </Button>\r\n          </PermissionControl>\r\n        )}\r\n      />\r\n\r\n      {contextHolder}\r\n    </>\r\n  );\r\n}\r\n"],"names":["props","prefixCls","customizePrefixCls","className","closeIcon","closable","type","title","children","footer","restProps","s","e","t","p","Object","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","i","length","propertyIsEnumerable","__rest","getPrefixCls","rootPrefixCls","rootCls","useCSSVarCls","wrapCSSVar","hashId","cssVarCls","confirmPrefixCls","additionalProps","assign","content","modalWarn","useModal","info","success","error","warning","warn","confirm","destroyAll","destroyFns","close","config","_InternalPanelDoNotUseOrYouWillBeFired","ModalForm","forwardRef","ref","width","submitText","cancelText","modalProps","formProps","onFinish","initialValues","afterClose","open","set","setOpen","useBoolean","loading","setLoading","useLoadingDelayAndKeep","useImperativeHandle","_jsx","Modal","onCancel","_jsxs","Space","Button","onClick","form","submit","centered","wrapClassName","maskClosable","Form","autoComplete","values","fnResult","Promise","setTrue","then","finally","setFalse","layout","createCompoundedComponent","useRef","mainComponent","subComponents","Component","keys","forEach","key","defineProperty","value","writable","enumerable","OptimisticSwitch","defaultChecked","onChange","checked","Switch","val","catch","AddOrEdit","React","message","App","id","setId","modalFormRef","formInstance","contextHolder","resetFields","data","apiUrl","successMsg","params","axios","callback","undefined","_Fragment","name","label","rules","required","Input","placeholder","addStart","current","editStart","row","setFieldsValue","getRoleList","pageIndex","pageSize","updateRoleStatusById","status","Page","tableRef","addOrEditRef","refresh","actionRender","isShowAction","useFilterElementPermission","render","ghost","size","permission","danger","columns","dataIndex","hideInSearch","enabled","disabled","roleEnabledState","options","fixed","hideInTable","ProTable","rowKey","headerTitle","request","result","list","records","total","toolBarRender","PermissionControl","icon","PlusOutlined"],"sourceRoot":""}