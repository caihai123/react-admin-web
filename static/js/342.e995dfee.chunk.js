"use strict";(self.webpackChunkreact_admin_web=self.webpackChunkreact_admin_web||[]).push([[342],{27366:function(e,t,n){n.r(t),n.d(t,{default:function(){return v}});var i=n(72816),a=n(96799),d=n(74918),r=n(97132),s=n(25877),l=n(58047),o=n(67987),c=n(63953),p=n(89526),u=n(5416),m=n(9740),h=n(57503),x=n(10011),Z=n(53139),y=n(91117),j=n(95267),g=n(49839),f=n(20485),C=n(67557);const b={id:"",parentId:void 0,deptName:"",description:""},I=function(e){const{message:t}=i.Z.useApp(),[n]=u.Z.useForm(),r=u.Z.useWatch("id",n),{data:s}=(0,o.uD)(),[l]=(0,o.SF)(),[c]=(0,o.Bz)(),g=p.useCallback((()=>n.setFieldsValue({...b,...e.initialValues})),[n,e.initialValues]);p.useEffect((()=>g()),[g]);const[f,I]=(0,j.ZP)(!1);return(0,C.jsx)(m.Z,{title:r?"编辑":"新增",width:800,open:e.visible,centered:!0,wrapClassName:"custom-modal-style",maskClosable:!1,footer:(0,C.jsxs)(d.Z,{children:[(0,C.jsx)(a.ZP,{onClick:()=>{e.onClose?.(),g()},children:"取消"}),(0,C.jsx)(a.ZP,{type:"primary",loading:f,onClick:()=>n.submit(),children:"确定"})]}),onCancel:()=>e.onClose?.(),children:(0,C.jsxs)(u.Z,{form:n,layout:"vertical",autoComplete:"off",onFinish:n=>{const i=r?c:l,a=r?"更新成功！":"新增成功！";I.setTrue(),i(n).unwrap().then((()=>{t.success(a),e.onClose?.()})).finally((()=>{I.setFalse()}))},initialValues:b,children:[(0,C.jsx)(u.Z.Item,{name:"id",hidden:!0,children:(0,C.jsx)(h.Z,{})}),(0,C.jsxs)(x.Z,{gutter:16,children:[(0,C.jsx)(Z.Z,{span:12,children:(0,C.jsx)(u.Z.Item,{label:"父节点",name:"parentId",required:!0,children:(0,C.jsx)(y.Z,{treeData:s,placeholder:"根节点",disabled:!0})})}),(0,C.jsx)(Z.Z,{span:12,children:(0,C.jsx)(u.Z.Item,{name:"deptName",label:"部门名称",rules:[{required:!0,message:"请填写部门名称"}],children:(0,C.jsx)(h.Z,{placeholder:"请输入"})})}),(0,C.jsx)(Z.Z,{span:24,children:(0,C.jsx)(u.Z.Item,{name:"description",label:"备注",children:(0,C.jsx)(h.Z.TextArea,{placeholder:"请输入"})})})]})]})})};var k=(0,g.Z)(I,{ManagedModal:function(e){const[t,{set:n}]=(0,f.Z)(!1);return(0,C.jsxs)(C.Fragment,{children:[e.content(n),(0,C.jsx)(I,{visible:t,initialValues:e.initialValues,onClose:()=>n(!1)})]})}});function v(){const{modal:e,message:t}=i.Z.useApp(),{data:n,isFetching:p,refetch:u}=(0,o.EY)(),[m]=(0,o.NY)(),[h,x]=(0,c.Fu)({render:e=>(0,C.jsx)(k.ManagedModal,{content:e=>(0,C.jsx)(a.ZP,{type:"primary",ghost:!0,size:"small",onClick:()=>e(!0),children:"编辑"}),initialValues:{id:e.id,parentId:e.parentId,deptName:e.deptName,description:e.description}},e.id),permission:"edit"},{render:e=>(0,C.jsx)(k.ManagedModal,{content:e=>(0,C.jsx)(a.ZP,{type:"primary",size:"small",onClick:()=>e(!0),children:"新增下级"}),initialValues:{parentId:e.id}}),permission:"add"},{render:n=>(0,C.jsx)(a.ZP,{type:"primary",danger:!0,size:"small",onClick:()=>e.confirm({title:"提示",content:"您确定要删除此部门及其子部门吗？",okType:"danger",onOk:()=>{return e=n.id,void m({id:e}).unwrap().then((()=>{t.success("删除成功！")}));var e},centered:!0}),children:"删除"}),permission:"del"}),Z=[{title:"部门名称",dataIndex:"deptName"},{title:"备注",dataIndex:"description"},{title:"操作",key:"action",render:e=>(0,C.jsx)(d.Z,{children:h(e)}),width:100,fixed:"right",hideInTable:!x}],[y]=(0,c.Fu)({render:()=>(0,C.jsx)(k.ManagedModal,{content:e=>(0,C.jsx)(a.ZP,{type:"primary",icon:(0,C.jsx)(l.Z,{}),onClick:()=>e(!0),children:"新增"})},"add"),permission:"add"},{render:()=>(0,C.jsx)(a.ZP,{onClick:()=>t.warning("演示功能"),children:"导出"}),permission:"export"}),[j,g]=(0,c.Fu)({render:()=>(0,C.jsx)(a.ZP,{type:"primary",danger:!0,onClick:()=>t.warning("演示功能"),children:"批量删除"}),permission:"del"},{render:()=>(0,C.jsx)(a.ZP,{onClick:()=>t.warning("演示功能"),children:"导出数据"},"export"),permission:"export"});return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(r.Z,{message:"此页面用redux管理数据，主要用来演示和体验RTK查询的功能",type:"info",showIcon:!0,closable:!0}),(0,C.jsx)(s.Z,{rowKey:"id",columns:Z,dataSource:n,headerTitle:"部门列表",loading:p,search:!1,onRefresh:u,toolBarRender:y(),batchBarRender:g?j():void 0})]})}},67987:function(e,t,n){n.d(t,{Bz:function(){return o},EY:function(){return r},NY:function(){return c},SF:function(){return l},uD:function(){return s}});const i=n(50158).Z.enhanceEndpoints({addTagTypes:["deptList","deptSelect"]}),a=(e=[],t)=>e.filter((e=>e.id!==t)).map((({children:e=[],...n})=>({...n,children:e.length?a(e,t):void 0}))),d=i.injectEndpoints({endpoints:e=>({getDeptAll:e.query({query:()=>"/api/dept/all",providesTags:["deptList"]}),getDeptSelect:e.query({query:()=>"/api/dept/select",providesTags:["deptSelect"]}),addDeptItem:e.mutation({query:e=>({url:"/api/dept/add",method:"POST",body:e}),invalidatesTags:["deptList","deptSelect"]}),updateDeptItem:e.mutation({query:e=>({url:"/api/dept/update",method:"POST",body:e}),invalidatesTags:["deptList","deptSelect"]}),deleteDeptItem:e.mutation({query:e=>({url:"/api/dept/delete",method:"POST",body:e}),invalidatesTags:["deptList","deptSelect"],async onQueryStarted({id:e},{dispatch:t,queryFulfilled:n}){const i=t(d.util.updateQueryData("getDeptAll",void 0,(t=>a(t,e))));try{await n}catch{i.undo()}}})})}),{useGetDeptAllQuery:r,useGetDeptSelectQuery:s,useAddDeptItemMutation:l,useUpdateDeptItemMutation:o,useDeleteDeptItemMutation:c}=d},53139:function(e,t,n){var i=n(78944);t.Z=i.Z},10011:function(e,t,n){var i=n(1308);t.Z=i.Z}}]);
//# sourceMappingURL=342.e995dfee.chunk.js.map