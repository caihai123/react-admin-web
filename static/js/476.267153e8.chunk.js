"use strict";(self.webpackChunkreact_admin_web=self.webpackChunkreact_admin_web||[]).push([[476],{83159:function(e,t,n){n.d(t,{S:function(){return s},n:function(){return i}});var r=n(95694);const s=()=>r.Z.get("/api/menu/all"),i=e=>r.Z.post("/api/menu/remove",{id:e})},81375:function(e,t,n){var r=n(89526),s=n(20485),i=n(9740),a=n(74918),o=n(96799),c=n(5416),l=n(95267),u=n(49839),d=n(67557);const h=(0,r.forwardRef)((function(e,t){const{title:n,width:u,submitText:h="确定",cancelText:f="取消",children:p,modalProps:m,formProps:Z,onFinish:b,footer:x,initialValues:k,afterClose:g}=e,[y,{set:j}]=(0,s.Z)(!1),[C,A]=(0,l.ZP)(!1);return(0,r.useImperativeHandle)(t,(()=>({open:()=>j(!0),close:()=>j(!1)}))),(0,d.jsx)(i.Z,{title:n,open:y,onCancel:()=>j(!1),width:u,footer:x||(0,d.jsxs)(a.Z,{children:[(0,d.jsx)(o.ZP,{onClick:()=>j(!1),children:f}),(0,d.jsx)(o.ZP,{type:"primary",loading:C,onClick:()=>e.form?.submit(),children:h})]}),centered:!0,wrapClassName:"custom-modal-style",maskClosable:!1,afterClose:g,...m,children:(0,d.jsx)(c.Z,{form:e.form,autoComplete:"off",onFinish:e=>{const t=b?.(e);t instanceof Promise&&(A.setTrue(),t.then((()=>j(!1))).finally((()=>A.setFalse())))},layout:"vertical",initialValues:k,...Z,children:p})})}));t.Z=(0,u.Z)(h,{useModal:function(e){const t=(0,r.useRef)(null),[n]=c.Z.useForm();return[t,n,(0,d.jsx)(h,{ref:t,form:n,...e})]}})},49839:function(e,t,n){function r(e,t){const n=e;return Object.keys(t).forEach((e=>{Object.defineProperty(n,e,{value:t[e],writable:!1,enumerable:!0})})),n}n.d(t,{Z:function(){return r}})},76324:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var r=n(89526),s=n(72816),i=n(96799),a=n(74918),o=n(58047),c=n(25877),l=n(20485),u=n(49367),d=n(95267),h=n(67557);function f({defaultChecked:e=!1,onChange:t=(()=>null)}){const[n,{set:r}]=(0,l.Z)(e),[s,{setTrue:i,setFalse:a}]=(0,d.ZP)(!1);return(0,h.jsx)(u.Z,{checked:n,loading:s,onChange:e=>{r(e),i(),t(e)?.catch((()=>{r(!e)})).finally((()=>a()))}})}var p=n(5416),m=n(31363),Z=n(95694),b=n(81375),x=n(49839);const k=r.forwardRef(((e,t)=>{const{message:n}=s.Z.useApp(),[i,a]=r.useState(""),[o,c,l]=b.Z.useModal({title:i?"编辑":"新增",width:600,afterClose:()=>{a(""),c?.resetFields()},onFinish:function(t){const r=i?"/api/role/update":"/api/role/add",s=i?"更新成功！":"新增成功！",a=i?{id:i,...t}:t;return Z.Z.post(r,a).then((()=>{n.success(s),e.callback(i?void 0:1)}))},children:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(p.Z.Item,{name:"roleName",label:"角色名称",rules:[{required:!0,message:"请填写角色名称"}],children:(0,h.jsx)(m.Z,{placeholder:"请输入"})}),(0,h.jsx)(p.Z.Item,{name:"description",label:"备注",children:(0,h.jsx)(m.Z.TextArea,{placeholder:"请输入"})})]})});return r.useImperativeHandle(t,(()=>({addStart:()=>o.current?.open(),editStart:e=>{a(e.id),c?.setFieldsValue(e),o.current?.open()}}))),l}));var g=(0,x.Z)(k,{useModal:function(e){const t=r.useRef(null);return[t,(0,h.jsx)(k,{ref:t,...e})]}}),y=n(16509),j=n(59827),C=n(9740),A=n(95810),v=n(88238),w=n(83159);const I=(e,t=1,n=10)=>Z.Z.post("/api/role/page",{params:e,pageIndex:t,pageSize:n}),S=(e,t)=>Z.Z.post("/api/role/status/update",{id:e,status:t}),P=e=>Z.Z.post("/api/role/remove",{id:e});var E=n(68347),F=n(22701),T=n(50706),R=n.n(T);const O=r.forwardRef(((e,t)=>{const[n,{set:i}]=(0,l.Z)(!1),{message:a}=s.Z.useApp(),{data:o,loading:c,mutate:u,run:f}=(0,v.Z)((async e=>{const t=await(0,w.S)();return(0,F.ff)(t.result,(e=>({...e,isAuth:R().mock({"boolean|1-2":!1}).boolean})))}),{manual:!0}),[p,m]=r.useState(!1),[b,x]=r.useState(!1);r.useEffect((()=>{const e=[],t=function(n=[]){n.forEach((n=>{e.push(n.isAuth),n.buttonList?.forEach((t=>{e.push(t.isAuth)})),t(n.children)}))};t(o),e.every((e=>!0===e))?(m(!0),x(!1)):e.every((e=>!0!==e))?(m(!1),x(!1)):(m(!1),x(!0))}),[o]);const k=r.useCallback((function(e){const t=function(n=[]){n.forEach((n=>{n.isAuth=e,n.buttonList?.forEach((t=>{t.isAuth=e})),t(n.children)}))};t(o),u((0,F.p$)(o))}),[o,u]),g=r.useCallback((function(e){const t=((e=[])=>{const t=[],n=function(e,r){t.push(e),(e.children||[]).forEach((t=>n(t,e.id)))};return e.forEach((e=>n(e,""))),t})(o);let n=t.find((t=>t.id===e));for(;n?.parentId;)n=t.find((e=>e.id===n?.parentId)),n&&(n.isAuth=!0);u((0,F.p$)(o))}),[o,u]),I=r.useCallback((function(e,t){const n=function(t){t.isAuth=e,t.buttonList?.forEach((t=>{t.isAuth=e})),t.children?.forEach((e=>{n(e)}))};e&&g(t.id),n(t),u((0,F.p$)(o))}),[g,u,o]),S=r.useCallback((function(e){(e.buttonList||[]).some((e=>!0===e.isAuth))&&(e.isAuth=!0,g(e.id)),u((0,F.p$)(o))}),[g,u,o]),[P,T]=(0,d.ZP)(!1),O=r.useCallback((function(){T.setTrue();return(t=(0,F.ff)(o,(e=>({id:e.id,isAuth:e.isAuth}))),Z.Z.post("/api/role/auth",t)).then((()=>{i(!1),e.callback(),a.success("更新成功！")})).finally((()=>T.setFalse()));var t}),[o,a,e,i,T]),z=[{title:"名称",dataIndex:"title"},{title:"类型",dataIndex:"type",render:e=>{const t=E.menuType.map[e];return(0,h.jsx)(y.Z,{color:t.color,children:t.label})},type:"select",options:E.menuType.options},{title:"按钮",dataIndex:"buttonList",render:(e,t)=>e?.map((e=>(0,h.jsx)(j.Z,{checked:e.isAuth,onChange:n=>{e.isAuth=n.target.checked,S(t)},children:e.name},e.id)))},{title:(0,h.jsx)(j.Z,{checked:p,indeterminate:b,onChange:e=>k(e.target.checked)}),key:"action",render:e=>(0,h.jsx)(j.Z,{checked:e.isAuth,onChange:t=>I(t.target.checked,e)})}];return r.useImperativeHandle(t,(()=>({start:e=>{f(e),i(!0)}}))),(0,h.jsx)(C.Z,{title:"角色授权",width:800,open:n,centered:!0,wrapClassName:"custom-modal-style",maskClosable:!1,onOk:()=>O(),onCancel:()=>i(!1),confirmLoading:P,children:(0,h.jsx)(A.Z,{rowKey:"id",size:"small",dataSource:o,columns:z,loading:c,pagination:!1,bordered:!0})})}));var z=(0,x.Z)(O,{useModal:function(e){const t=r.useRef(null);return[t,(0,h.jsx)(O,{ref:t,...e})]}}),L=n(63953);function M(){const{modal:e,message:t}=s.Z.useApp(),n=(0,r.useRef)(null),[l,u]=g.useModal({callback:e=>n.current?.refresh(e)}),[d,p]=z.useModal({callback:()=>n.current?.refresh()}),[m,Z]=(0,L.Fu)({render:e=>(0,h.jsx)(i.ZP,{type:"primary",ghost:!0,size:"small",onClick:()=>l.current?.editStart(e),children:"编辑"}),permission:"edit"},{render:e=>(0,h.jsx)(i.ZP,{type:"primary",size:"small",style:{background:"#e6a23c"},onClick:()=>d.current?.start(e.id),children:"授权"}),permission:"accredit"},{render:n=>(0,h.jsx)(i.ZP,{type:"primary",danger:!0,size:"small",onClick:()=>e.confirm({title:"提示",content:"确定要删除此角色吗？",okType:"danger",onOk:()=>P(n.id).then((()=>t.success("删除成功！"))),centered:!0}),children:"删除"}),permission:"del"}),b=[{title:"角色名称",dataIndex:"roleName"},{title:"备注",dataIndex:"description",hideInSearch:!0},{title:"状态",dataIndex:"status",render:(e,n)=>{const{enabled:r,disabled:s}=E.roleEnabledState.enum;return(0,h.jsx)(f,{defaultChecked:e===r,onChange:e=>S(n.id,e?r:s).then((()=>{t.success("切换成功！")}))})},type:"select",options:E.roleEnabledState.options},{title:"操作",key:"action",render:e=>(0,h.jsx)(a.Z,{children:m(e)}),width:100,fixed:"right",hideInSearch:!0,hideInTable:!Z}];return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.Z,{ref:n,columns:b,rowKey:"id",headerTitle:"角色列表",request:(e,{current:t,pageSize:n})=>I(e,t,n).then((e=>{const{result:t}=e;return{list:t.records,total:t.total}})),toolBarRender:()=>(0,h.jsx)(L.ZP,{permission:"add",children:(0,h.jsx)(i.ZP,{type:"primary",icon:(0,h.jsx)(o.Z,{}),onClick:()=>l.current?.addStart(),children:"新增"})})}),u,p]})}},22701:function(e,t,n){n.d(t,{Bb:function(){return r},Zm:function(){return i},ff:function(){return a},p$:function(){return s}});const r=function(e){const t=e.split("/"),n=t[t.length-1],r=n.lastIndexOf(".");return r<=0?n:n.substring(0,r)+n.substring(r)},s=function(e){if("object"!=typeof e||null===e)return e;const t=Array.isArray(e)?[]:{};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=s(e[n]));return t},i=function(e=[],t){const n=s(e),r=e=>e.map((e=>{const n=r(e.children||[]);return t(e)?(e.children=n.length>0?n:void 0,e):n&&n.length>0?(e.children=n,e):null})).filter((e=>null!==e));return r(n)},a=function(e=[],t){const n=e=>e.map((e=>{const r=t({...e});return r.children&&r.children.length>0&&(r.children=n(r.children)),r}));return n(e)}}}]);
//# sourceMappingURL=476.267153e8.chunk.js.map