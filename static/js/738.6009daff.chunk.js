"use strict";(self.webpackChunkreact_admin_web=self.webpackChunkreact_admin_web||[]).push([[738],{83159:function(e,n,t){t.d(n,{S:function(){return l},n:function(){return s}});var r=t(95694);const l=()=>r.Z.get("/api/menu/all"),s=e=>r.Z.post("/api/menu/remove",{id:e})},10427:function(e,n,t){var r=t(54374),l=t(53725),s=t(68347),i=t(67557);const a=s;n.Z=function(e){const{dictName:n,placeholder:t="请选择",...s}=e,{options:o}=a[n];return(0,i.jsx)(r.default,{...s,placeholder:t,children:o.map((e=>(0,i.jsx)(r.default.Option,{value:e.value,children:e.color?(0,i.jsx)(l.Z,{color:e.color,text:e.label}):e.label},e.value)))})}},81375:function(e,n,t){var r=t(89526),l=t(20485),s=t(9740),i=t(74918),a=t(96799),o=t(5416),c=t(95267),d=t(49839),u=t(67557);const m=(0,r.forwardRef)((function(e,n){const{title:t,width:d,submitText:m="确定",cancelText:p="取消",children:h,modalProps:f,formProps:Z,onFinish:x,footer:j,initialValues:y,afterClose:b}=e,[g,{set:v}]=(0,l.Z)(!1),[k,I]=(0,c.ZP)(!1);return(0,r.useImperativeHandle)(n,(()=>({open:()=>v(!0),close:()=>v(!1)}))),(0,u.jsx)(s.Z,{title:t,open:g,onCancel:()=>v(!1),width:d,footer:j||(0,u.jsxs)(i.Z,{children:[(0,u.jsx)(a.ZP,{onClick:()=>v(!1),children:p}),(0,u.jsx)(a.ZP,{type:"primary",loading:k,onClick:()=>e.form?.submit(),children:m})]}),centered:!0,wrapClassName:"custom-modal-style",maskClosable:!1,afterClose:b,...f,children:(0,u.jsx)(o.Z,{form:e.form,autoComplete:"off",onFinish:e=>{const n=x?.(e);n instanceof Promise&&(I.setTrue(),n.then((()=>v(!1))).finally((()=>I.setFalse())))},layout:"vertical",initialValues:y,...Z,children:h})})}));n.Z=(0,d.Z)(m,{useModal:function(e){const n=(0,r.useRef)(null),[t]=o.Z.useForm();return[n,t,(0,u.jsx)(m,{ref:n,form:t,...e})]}})},49839:function(e,n,t){function r(e,n){const t=e;return Object.keys(n).forEach((e=>{Object.defineProperty(t,e,{value:n[e],writable:!1,enumerable:!0})})),t}t.d(n,{Z:function(){return r}})},80035:function(e,n,t){t.r(n),t.d(n,{default:function(){return O}});var r=t(89526),l=t(72816),s=t(96799),i=t(24059),a=t(16509),o=t(74918),c=t(31363),d=t(25877),u=t(60561),m=t(58047),p=t(68347),h=t(83159),f=t(63953),Z=t(5416),x=t(10011),j=t(53139),y=t(91117),b=t(95694),g=t(81375),v=t(10427),k=t(49839),I=t(17431);const w={pattern:/^\/[\w-/]*$/,message:"必须以斜杠开头，后跟字母、数字、下划线、中划线或斜杠"},C={pattern:/^[a-z][a-z0-9-]*$/,message:"只能是小写字母、中划线和数字组成，且必须以字母开头"};var T=t(67557);const P=r.forwardRef(((e,n)=>{const{message:t}=l.Z.useApp(),[i,a]=r.useState(""),d=r.useRef(null),[u]=Z.Z.useForm(),m=Z.Z.useWatch("type",u);return r.useImperativeHandle(n,(()=>({addStart:e=>{u.setFieldValue("parentId",e),d.current?.open()},editStart:e=>{a(e.id),u.setFieldsValue(e),d.current?.open()}}))),(0,T.jsxs)(g.Z,{ref:d,form:u,title:i?"编辑":"新增",width:800,afterClose:()=>{a(""),u.resetFields()},initialValues:{type:p.menuType.enum.menu},onFinish:n=>{const r=i?"/api/menu/update":"/api/menu/add",l=i?"更新成功！":"新增成功！",s=i?{id:i,...n}:n;return b.Z.post(r,s).then((()=>{t.success(l),e.callback(!i)}))},children:[(0,T.jsxs)(x.Z,{gutter:16,children:[(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(Z.Z.Item,{label:"父节点",name:"parentId",required:!0,children:(0,T.jsx)(y.Z,{treeData:e.menuTreeAll,fieldNames:{label:"title",value:"id"},placeholder:"根节点",disabled:!0})})}),(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(Z.Z.Item,{label:"名称",name:"title",rules:[{required:!0},{type:"string",min:2,max:10,message:"长度在 2 到 10 个字符！"}],children:(0,T.jsx)(c.Z,{placeholder:"菜单名称"})})}),(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(Z.Z.Item,{label:"类型",name:"type",rules:[{required:!0}],children:(0,T.jsx)(v.Z,{placeholder:"菜单类型",dictName:"menuType"})})}),m===p.menuType.enum.menu&&(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(Z.Z.Item,{label:"路径",name:"path",rules:[{required:!0},w],children:(0,T.jsx)(c.Z,{placeholder:"菜单路径"})})}),(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(Z.Z.Item,{label:"图标",name:"icon",children:(0,T.jsx)(c.Z,{placeholder:"图标名称"})})})]}),m===p.menuType.enum.menu&&(0,T.jsx)(x.Z,{gutter:16,children:(0,T.jsx)(j.Z,{span:12,children:(0,T.jsx)(Z.Z.Item,{label:"按钮",children:(0,T.jsx)(Z.Z.List,{name:"buttonList",children:(e,n)=>(0,T.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[e.map((({key:e,name:t})=>(0,T.jsxs)(o.Z,{align:"baseline",children:[(0,T.jsx)(Z.Z.Item,{name:[t,"name"],rules:[{required:!0,message:"按钮名称是必选字段"}],children:(0,T.jsx)(c.Z,{placeholder:"按钮名称"})}),(0,T.jsx)(Z.Z.Item,{name:[t,"id"],rules:[{required:!0,message:"按钮标识是必选字段"},C],children:(0,T.jsx)(c.Z,{placeholder:"按钮标识"})}),(0,T.jsx)(I.Z,{onClick:()=>n.remove(t)})]},e))),(0,T.jsx)(s.ZP,{type:"dashed",onClick:()=>n.add(),block:!0,children:"+ 新增按钮"})]})})})})})]})}));var S=(0,k.Z)(P,{useModal:function(e){const n=r.useRef(null);return[n,(0,T.jsx)(P,{ref:n,...e})]}}),F=t(88238),R=t(22701);function O(){const{modal:e,message:n}=l.Z.useApp(),{data:t,loading:Z,refresh:x}=(0,F.Z)((async()=>(await(0,h.S)()).result)),[j,y]=r.useState(),[b,g]=r.useState(),v=r.useMemo((()=>b?(0,R.Zm)(t,(e=>e.title.toLowerCase().includes(b.toLowerCase()))):t),[t,b]),[k,I]=S.useModal({menuTreeAll:t,callback:e=>{x(),e&&(g(void 0),y(void 0))}}),[w,C]=(0,f.Fu)({render:e=>(0,T.jsx)(s.ZP,{type:"primary",ghost:!0,size:"small",onClick:()=>k.current?.editStart(e),children:"编辑"}),permission:"edit"},{render:e=>(0,T.jsx)(s.ZP,{type:"primary",size:"small",onClick:()=>k.current?.addStart(e.id),children:"新增下级"}),permission:"add"},{render:t=>(0,T.jsx)(s.ZP,{type:"primary",danger:!0,size:"small",onClick:()=>e.confirm({title:"提示",content:"确定要删除此菜单及其子菜单吗？",okType:"danger",onOk:()=>(0,h.n)(t.id).then((()=>n.success("删除成功！"))),centered:!0}),children:"删除"}),permission:"del"}),{token:{colorError:P}}=i.Z.useToken(),O=r.useCallback((function(e,n){if(!n)return e;const t=new RegExp(`(${n})`,"gi");return e.replace(t,`<span style="color:${P}">$1</span>`)}),[P]),q=[{title:"名称",dataIndex:"title",render:e=>(0,T.jsx)("div",{dangerouslySetInnerHTML:{__html:O(e,b||"")}}),width:300},{title:"路径",dataIndex:"path"},{title:"图标",dataIndex:"icon",hideInSearch:!0},{title:"类型",dataIndex:"type",render:e=>{const n=p.menuType.map[e];return(0,T.jsx)(a.Z,{color:n.color,children:n.label})},type:"select",options:p.menuType.options},{title:"按钮",dataIndex:"buttonList",render:e=>e?.map((e=>(0,T.jsx)(a.Z,{color:"#2db7f5",children:e.name},e.id)))},{title:"操作",key:"action",render:e=>(0,T.jsx)(o.Z,{children:w(e)}),width:100,fixed:"right",hideInSearch:!0,hideInTable:!C}];return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(d.Z,{rowKey:"id",dataSource:v,search:!1,columns:q,headerTitle:"菜单列表",toolBarRender:(0,T.jsxs)(o.Z,{children:[(0,T.jsx)(c.Z,{value:j,prefix:(0,T.jsx)(u.Z,{}),placeholder:"输入菜单名称查询",style:{width:200},onChange:e=>y(e.target.value),onPressEnter:()=>g(j)}),(0,T.jsx)(f.ZP,{permission:"add",children:(0,T.jsx)(s.ZP,{type:"primary",icon:(0,T.jsx)(m.Z,{}),onClick:()=>k.current?.addStart(),children:"新增"})})]}),pagination:!1,loading:Z,onRefresh:()=>x()}),I]})}},22701:function(e,n,t){t.d(n,{Bb:function(){return r},Zm:function(){return s},ff:function(){return i},p$:function(){return l}});const r=function(e){const n=e.split("/"),t=n[n.length-1],r=t.lastIndexOf(".");return r<=0?t:t.substring(0,r)+t.substring(r)},l=function(e){if("object"!=typeof e||null===e)return e;const n=Array.isArray(e)?[]:{};for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=l(e[t]));return n},s=function(e=[],n){const t=l(e),r=e=>e.map((e=>{const t=r(e.children||[]);return n(e)?(e.children=t.length>0?t:void 0,e):t&&t.length>0?(e.children=t,e):null})).filter((e=>null!==e));return r(t)},i=function(e=[],n){const t=e=>e.map((e=>{const r=n({...e});return r.children&&r.children.length>0&&(r.children=t(r.children)),r}));return t(e)}},53139:function(e,n,t){var r=t(78944);n.Z=r.Z},10011:function(e,n,t){var r=t(1308);n.Z=r.Z}}]);
//# sourceMappingURL=738.6009daff.chunk.js.map